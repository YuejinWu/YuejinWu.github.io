<!DOCTYPE html><html lang="en &amp;&amp; zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>高级SQL 简读 | Yuejin's Blog</title><meta name="keywords" content="Database,SQL"><meta name="author" content="Yuejin Wu"><meta name="copyright" content="Yuejin Wu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="高级SQL 简读"><meta name="application-name" content="高级SQL 简读"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="高级SQL 简读"><meta property="og:url" content="http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/index.html"><meta property="og:site_name" content="Yuejin's Blog"><meta property="og:description" content="第一章：从编程语言访问 SQL 1.1 概述：数据库应用系统架构 数据库应用系统 (DBAS) 由用户 (Users)、应用程序 (Application Programs)、数据库管理系统 (DBMS) 和数据库 (DB) 四部分组成。应用程序需要与数据库服务器进行交互，这通常通过应用程序编程接口"><meta property="og:locale" content="en &amp;&amp; zh-Hans"><meta property="og:image" content="http://example.com/img/SQL_cover.png"><meta property="article:author" content="Yuejin Wu"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/SQL_cover.png"><meta name="description" content="第一章：从编程语言访问 SQL 1.1 概述：数据库应用系统架构 数据库应用系统 (DBAS) 由用户 (Users)、应用程序 (Application Programs)、数据库管理系统 (DBMS) 和数据库 (DB) 四部分组成。应用程序需要与数据库服务器进行交互，这通常通过应用程序编程接口"><link rel="shortcut icon" href="/img/mylogo.jpg"><link rel="canonical" href="http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":null,"LingQueMonitorID":null},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Yuejin Wu","link":"链接: ","source":"来源: Yuejin's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Yuejin's Blog',
  title: '高级SQL 简读',
  postAI: '',
  pageFillDescription: '第一章：从编程语言访问 SQL, 1.1 概述：数据库应用系统架构, 1.2 访问 SQL 的两种主要途径, 1.2.1 动态 SQL, 1.2.2 嵌入式 SQL, 1.3 JDBC 详解, 1.3.1 JDBC 核心编程模型, 1.3.2 关键组件与步骤解析, 1.3.3 预编译语句, 1.3.4 元数据检索, 1.3.5 事务控制, 1.3.6 调用存储过程和函数, 1.4 ODBC 详解, 1.4.1 ODBC 架构, 1.4.2 ODBC C 语言编程示例, 1.4.3 连接时长管理, 1.5 嵌入式 SQL 详解, 1.5.1 基本概念, 1.5.2 语法与示例, 第二章：SQL 函数与存储过程, 2.1 SQL 函数, 2.1.1 创建 SQL 标量函数, 2.1.2 使用 SQL 函数, 2.2 SQL 存储过程, 2.2.1 创建存储过程, 2.2.2 调用存储过程, 2.3 优势与存储, 第三章：触发器, 3.1 触发器概述, 3.1.1 定义与模型, 3.1.2 语法概览, 3.2 行级触发器, 3.2.1 引用新旧行值, 3.2.2 应用示例, 3.3 语句级触发器, 3.4 触发器的适用与不适用场景, 3.4.1 适用场景, 3.4.2 不适用/慎用场景（现代最佳实践）, 3.5 总结, 本章总结第一章从编程语言访问概述数据库应用系统架构数据库应用系统由用户应用程序数据库管理系统和数据库四部分组成应用程序需要与数据库服务器进行交互这通常通过应用程序编程接口实现一个典型的交互流程包括连接数据库服务器向数据库服务器发送命令将查询结果集中的元组逐个提取到程序变量中进行处理访问的两种主要途径动态定义在通用编程语言如中程序将查询动态构建为字符串然后通过函数提交给数据库并获取结果特点查询在运行时构建和发送非常灵活需要在程序中显式处理连接语句执行和结果集获取主流技术用于语言的数据库连接标准一种开放的与语言无关的数据库连接标准支持等多种语言嵌入式定义将语句直接嵌入到宿主语言如的源代码中在编译时由预处理器将这些语句转换为特定数据库的函数调用特点语句在编译时确定可进行早期语法检查和优化编程模型更接近原生通常通过游标处理结果集最终实现依赖于底层的动态机制详解是数据库连接的标准它提供了一套用于执行语句检索结果以及访问数据库元数据的接口核心编程模型一个典型的程序包含以下步骤如示例代码所示加载数据库驱动程序可省略建立数据库连接创建语句对象执行数据更新操作执行查询并处理结果集清理资源关键组件与步骤解析加载驱动用于显式加载驱动类自起支持驱动自动发现此步骤可省略建立连接通过获取对象格式因数据库而异创建语句使用创建对象用于发送静态语句执行语句更新操作使用执行等语句返回受影响的行数查询操作使用执行语句返回一个对象处理结果集方法将游标移动到下一行如果有数据则返回使用等方法获取当前行的列值可以使用列名字符串或列索引从开始指定列处理空值可以使用方法检查上一次调用读取的值是否为异常处理使用块捕获资源关闭必须显式关闭和对象以释放数据库资源现代可使用语法自动管理预编译语句为了提升性能和安全防止注入应使用原理语句被预编译并存储在数据库中其中参数用占位执行时只需传入参数值优点高效多次执行同一模板语句时无需重复编译安全参数值会被正确转义示例设置第一个的值索引从开始重用同一插入另一条记录元数据检索允许程序动态探查数据库的结构结果集元数据获取查询结果的列信息数据库元数据获取数据库整体信息如表列主键等获取指定表的所有列信息获取指定表的主键信息事务控制默认情况下处于自动提交模式每条语句都是一个独立的事务手动管理事务关闭自动提交执行多条更新语句提交事务发生错误时回滚恢复自动提交调用存储过程和函数使用调用函数注册输出参数设置输入参数调用存储过程详解是一个与编程语言和数据库无关的调用级接口标准架构应用程序驱动程序管理器特定的驱动数据库驱动程序管理器负责加载卸载驱动程序并作为应用程序的入口点驱动程序由数据库厂商提供负责将标准的调用转换为特定数据库的通信协议语言编程示例返回码环境句柄连接句柄语句句柄分配环境句柄分配连接句柄建立连接分配语句句柄执行语句绑定结果列到变量逐行获取结果清理资源连接时长管理实际数据库平台对客户端连接时长有限制如默认秒如果查询执行时间超过连接时长操作会被强行终止可通过或连接字符串参数调整连接超时设置以确保长时间操作顺利完成嵌入式详解基本概念宿主语言嵌入语句的通用编程语言如工作原理源代码通过预处理器将嵌入式语句转换为对数据库运行时库的函数调用然后再由宿主语言编译器编译优点结合了强大的数据操作能力和宿主语言的计算流程控制能力语法与示例声明共享变量宿主语言变量需在特殊声明节中声明并在语句前加冒号引用连接数据库静态查询与游标当查询返回多行结果时必须使用游标声明游标打开游标执行查询循环获取数据使用检查状态处理关闭游标通过游标更新数据声明为可更新游标更新当前游标指向的行第二章函数与存储过程函数函数是接受参数执行计算并返回一个标量值的命名程序单元创建标量函数创建一个返回指定部门教师人数的函数说明指定返回值的类型定义函数体用于声明局部变量将查询结果赋值给变量语句返回值使用函数函数可以在语句中像内置函数一样使用查询教师人数超过人的院系及其预算存储过程存储过程与函数类似但通常不直接返回值而是通过输出参数返回结果并且可以执行更复杂的操作包括数据修改创建存储过程输入参数输出参数调用存储过程从嵌入式中调用从动态中调用如前文部分所示从脚本或其他过程中调用优势与存储预编译与优化函数和存储过程在创建时即被编译和优化生成执行计划并存储在数据库字典中性能提升应用程序调用时无需重复进行语法分析优化直接执行效率高减少网络流量将复杂逻辑在数据库端执行只返回结果避免了大量中间数据的传输代码重用与封装业务逻辑被封装在数据库中可供多个应用程序共享保证一致性第三章触发器触发器概述定义与模型触发器是一种特殊的存储过程它自动响应数据库表上的特定数据修改事件并根据预定义的条件执行相应的动作事件引发触发器执行的操作插入更新删除条件可选一个布尔表达式当条件为真时触发器动作才执行动作触发器要执行的一系列语句用于实现数据检查完整性维护或业务逻辑语法概览触发动作体语句行级触发器行级触发器对受事件影响的每一行都执行一次触发动作引用新旧行值在触发器体内可以引用被修改行的旧值和新值用于和操作引用修改前的行用于和操作引用修改后的行应用示例数据清洗触发器在插入或更新前修正数据当新成绩为空字符串时将其设置为说明此触发器在表的列被更新前触发如果新值是空字符串则将其改为触发器可以修改即将写入数据库的新值维护参照完整性复杂检查实现比外键约束更复杂的关联规则示例插入时检查有效性回滚整个插入事务说明当尝试插入一个不在表中的记录时事务被回滚示例删除时防止孤立引用被删除的是表中该的最后一条记录并且该仍在表中被引用说明防止删除一个正在被表使用的且确保它是该的最后一个实例维护派生数据自动更新保持数据间的一致性说明当学生某门课的成绩从不通过或空变为通过非且非空时自动将该课程的学分累加到学生的总学分中语句级触发器语句级触发器在每个触发事件上只执行一次无论该语句影响了多少行语法使用这是默认值引用过渡表可以使用或来引用被该语句影响的所有行的旧值或新值的集合过渡表适用场景当触发动作不依赖于具体每一行的数据或者需要对所有受影响的行进行批量操作时语句级触发器比行级触发器更高效注意过渡表需在子句中引用触发器的适用与不适用场景适用场景实现复杂的业务规则或完整性约束这些约束无法通过标准的约束来表达审计与日志记录自动记录数据变更谁何时改了哪些数据维护衍生或汇总数据尽管现在有更好的选择见下文数据同步与复制在早期技术中不适用慎用场景现代最佳实践维护汇总数据旧方式用触发器在每次数据变更时更新汇总表如部门总工资现代方式使用物化视图数据库系统可以自动高效地维护物化视图的更新通常比手写触发器更可靠性能更好数据库复制旧方式用触发器将变更记录到增量表再由其他进程应用现代方式使用数据库内置的复制功能如日志传输逻辑复制这些功能更健壮对性能影响更小简单的数据有效性检查首选应尽量使用声明式的完整性约束约束更易于声明理解和维护且通常由更高效地执行过度复杂的业务逻辑问题将大量复杂逻辑放入触发器可能导致逻辑黑洞使得数据变更行为难以理解和调试也增加了应用与数据库的耦合度建议考虑将核心业务逻辑放在应用层或中间件数据库主要负责数据存储和基本完整性总结触发器是基于事件条件动作模型的强大工具是实现复杂数据完整性规则和自动化业务逻辑的有效手段然而在现代数据库系统中应优先考虑使用声明式约束和内置功能如物化视图复制来满足需求当必须使用触发器时应谨慎设计确保其逻辑清晰高效并做好充分文档记录以避免维护的复杂性本章总结第五章高级将的能力从单纯的数据查询操作扩展到与应用程序的深度集成以及数据库内部的程序化逻辑与编程语言集成掌握了通过和嵌入式从应用程序中连接查询和操作数据库的核心模式与技术细节理解连接管理事务控制预编译语句和元数据访问是构建健壮数据库应用的基础数据库端程序化逻辑学会了在数据库服务器内部创建可重用的逻辑单元函数返回标量值和存储过程执行操作可通过参数返回结果它们提高了代码复用性减少了网络开销并允许将业务逻辑封装在数据层自动化响应机制深入理解了触发器这一基于事件条件动作模型的强大工具能够创建行级和语句级触发器用于实现复杂的数据完整性约束自动维护衍生数据记录审计日志等同时也认识到应优先使用声明式约束和现代数据库内置功能仅在必要时谨慎使用触发器',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-12-24 01:31:07',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><style>
  /* === 只添加半透明磨砂效果，不改变任何布局 === */
  
  /* 1. 导航栏内所有可点击元素添加磨砂背景 */
  #nav a,
  #nav button {
    /* 保持原有布局，只添加背景效果 */
    backdrop-filter: blur(6px) !important;
    -webkit-backdrop-filter: blur(6px) !important;
    transition: backdrop-filter 0.3s ease !important;
  }
  
  /* 2. 浅色模式：白色半透明 */
  body:not([data-theme="dark"]) #nav a,
  body:not([data-theme="dark"]) #nav button {
    background-color: rgba(255, 255, 255, 0.1) !important;
  }
  
  /* 3. 深色模式：黑色半透明 */
  [data-theme="dark"] #nav a,
  [data-theme="dark"] #nav button {
    background-color: rgba(0, 0, 0, 0.1) !important;
  }
  
  /* 4. 悬停效果：稍微增加透明度 */
  #nav a:hover,
  #nav button:hover {
    backdrop-filter: blur(8px) !important;
    -webkit-backdrop-filter: blur(8px) !important;
  }
  
  body:not([data-theme="dark"]) #nav a:hover,
  body:not([data-theme="dark"]) #nav button:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
  }
  
  [data-theme="dark"] #nav a:hover,
  [data-theme="dark"] #nav button:hover {
    background-color: rgba(0, 0, 0, 0.15) !important;
  }
</style>
<link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 8.1.1"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://hexo.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Yuejin's Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI-Platform/" style="font-size: 1.05rem;">AI Platform<sup>1</sup></a><a href="/tags/Database/" style="font-size: 1.05rem;">Database<sup>12</sup></a><a href="/tags/English/" style="font-size: 1.05rem;">English<sup>1</sup></a><a href="/tags/RNN/" style="font-size: 1.05rem;">RNN<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 1.05rem;">SQL<sup>6</sup></a><a href="/tags/Self-Attention/" style="font-size: 1.05rem;">Self Attention<sup>1</sup></a><a href="/tags/plan/" style="font-size: 1.05rem;">plan<sup>2</sup></a><a href="/tags/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/" style="font-size: 1.05rem;">关系模型<sup>1</sup></a><a href="/tags/%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B/" style="font-size: 1.05rem;">自注意力<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">December 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Database/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Database</span></a><a class="article-meta__tags" href="/tags/SQL/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>SQL</span></a></span></div></div><h1 class="post-title" itemprop="name headline">高级SQL 简读</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-12-23T17:27:51.680Z" title="发表于 2025-12-24 01:27:51">2025-12-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-12-23T17:31:07.260Z" title="更新于 2025-12-24 01:31:07">2025-12-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/SQL_cover.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/"><header><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a><a href="/tags/Database/" tabindex="-1" itemprop="url">Database</a><a href="/tags/SQL/" tabindex="-1" itemprop="url">SQL</a><h1 id="CrawlerTitle" itemprop="name headline">高级SQL 简读</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Yuejin Wu</span><time itemprop="dateCreated datePublished" datetime="2025-12-23T17:27:51.680Z" title="发表于 2025-12-24 01:27:51">2025-12-24</time><time itemprop="dateCreated datePublished" datetime="2025-12-23T17:31:07.260Z" title="更新于 2025-12-24 01:31:07">2025-12-24</time></header><h2 id="第一章：从编程语言访问-SQL">第一章：从编程语言访问 SQL</h2>
<h3 id="1-1-概述：数据库应用系统架构">1.1 概述：数据库应用系统架构</h3>
<p>数据库应用系统 (DBAS) 由用户 (Users)、应用程序 (Application Programs)、数据库管理系统 (DBMS) 和数据库 (DB) 四部分组成。应用程序需要与数据库服务器进行交互，这通常通过应用程序编程接口 (API) 实现。一个典型的交互流程包括：</p>
<ol>
<li>连接数据库服务器。</li>
<li>向数据库服务器发送 SQL 命令。</li>
<li>将查询结果集中的元组逐个提取到程序变量中进行处理。</li>
</ol>
<h3 id="1-2-访问-SQL-的两种主要途径">1.2 访问 SQL 的两种主要途径</h3>
<h4 id="1-2-1-动态-SQL">1.2.1 动态 SQL</h4>
<ul>
<li><strong>定义</strong>：在通用编程语言（如 Java、C、C++）中，程序将 SQL 查询动态构建为字符串，然后通过 API 函数提交给数据库并获取结果。</li>
<li><strong>特点</strong>：
<ul>
<li>查询在运行时构建和发送，非常灵活。</li>
<li>需要在程序中显式处理连接、语句执行和结果集获取。</li>
</ul>
</li>
<li><strong>主流技术</strong>：
<ul>
<li><strong>JDBC</strong>：用于 Java 语言的数据库连接标准。</li>
<li><strong>ODBC</strong>：一种开放的、与语言无关的数据库连接标准，支持 C、C++ 等多种语言。</li>
</ul>
</li>
</ul>
<h4 id="1-2-2-嵌入式-SQL">1.2.2 嵌入式 SQL</h4>
<ul>
<li><strong>定义</strong>：将 SQL 语句直接嵌入到宿主语言（如 C、COBOL）的源代码中。在编译时，由预处理器将这些 SQL 语句转换为特定数据库 API 的函数调用。</li>
<li><strong>特点</strong>：
<ul>
<li>SQL 语句在编译时确定，可进行早期语法检查和优化。</li>
<li>编程模型更接近原生 SQL，通常通过游标处理结果集。</li>
<li>最终实现依赖于底层的动态 SQL 机制。</li>
</ul>
</li>
</ul>
<h3 id="1-3-JDBC-详解">1.3 JDBC 详解</h3>
<p>JDBC 是 Java 数据库连接的标准 API，它提供了一套用于执行 SQL 语句、检索结果以及访问数据库元数据的接口。</p>
<h4 id="1-3-1-JDBC-核心编程模型">1.3.1 JDBC 核心编程模型</h4>
<p>一个典型的 JDBC 程序包含以下步骤，如示例代码所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">JDBCexample</span><span class="params">(String userid, String passwd)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 加载数据库驱动程序 (JDBC 4+ 可省略)</span></span><br><span class="line">        Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. 建立数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(</span><br><span class="line">            <span class="string">&quot;jdbc:oracle:thin:@db.yale.edu:1521:univdb&quot;</span>,</span><br><span class="line">            userid, passwd);</span><br><span class="line">        <span class="comment">// 3. 创建语句对象</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="comment">// 4a. 执行数据更新操作</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stmt.executeUpdate(</span><br><span class="line">                <span class="string">&quot;insert into instructor values(&#x27;77987&#x27;, &#x27;Kim&#x27;, &#x27;Physics&#x27;, 98000)&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException sqle) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Could not insert tuple. &quot;</span> + sqle);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4b. 执行查询并处理结果集</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rset</span> <span class="operator">=</span> stmt.executeQuery(</span><br><span class="line">            <span class="string">&quot;select dept_name, avg(salary) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;from instructor &quot;</span> +</span><br><span class="line">            <span class="string">&quot;group by dept_name&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (rset.next()) &#123;</span><br><span class="line">            System.out.println(rset.getString(<span class="string">&quot;dept_name&quot;</span>) + <span class="string">&quot; &quot;</span> + rset.getFloat(<span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5. 清理资源</span></span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception sqle) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Exception: &quot;</span> + sqle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-2-关键组件与步骤解析">1.3.2 关键组件与步骤解析</h4>
<ol>
<li><strong>加载驱动</strong>：<code>Class.forName()</code> 用于显式加载 JDBC 驱动类。自 JDBC 4.0 (Java 6) 起，支持驱动自动发现，此步骤可省略。</li>
<li><strong>建立连接</strong>：通过 <code>DriverManager.getConnection(url, user, password)</code> 获取 <code>Connection</code> 对象。URL 格式因数据库而异。</li>
<li><strong>创建语句</strong>：使用 <code>Connection.createStatement()</code> 创建 <code>Statement</code> 对象，用于发送静态 SQL 语句。</li>
<li><strong>执行语句</strong>：
<ul>
<li><strong>更新操作</strong>：使用 <code>executeUpdate()</code> 执行 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>CREATE TABLE</code> 等语句，返回受影响的行数。</li>
<li><strong>查询操作</strong>：使用 <code>executeQuery()</code> 执行 <code>SELECT</code> 语句，返回一个 <code>ResultSet</code> 对象。</li>
</ul>
</li>
<li><strong>处理结果集</strong>：
<ul>
<li><code>ResultSet.next()</code> 方法将游标移动到下一行，如果有数据则返回 <code>true</code>。</li>
<li>使用 <code>getString(columnLabel/Index)</code>、<code>getInt()</code>、<code>getFloat()</code> 等方法获取当前行的列值。</li>
<li>可以使用列名（字符串）或列索引（从1开始）指定列。</li>
</ul>
</li>
<li><strong>处理空值</strong>：可以使用 <code>ResultSet.wasNull()</code> 方法检查上一次 <code>getXXX()</code> 调用读取的值是否为 SQL <code>NULL</code>。</li>
<li><strong>异常处理</strong>：使用 <code>try-catch</code> 块捕获 <code>SQLException</code>。</li>
<li><strong>资源关闭</strong>：必须显式关闭 <code>ResultSet</code>、<code>Statement</code> 和 <code>Connection</code> 对象以释放数据库资源。现代 Java 可使用 <code>try-with-resources</code> 语法自动管理。</li>
</ol>
<h4 id="1-3-3-预编译语句">1.3.3 预编译语句</h4>
<p>为了提升性能和安全（防止SQL注入），应使用 <code>PreparedStatement</code>。</p>
<ul>
<li><strong>原理</strong>：SQL 语句被预编译并存储在数据库中，其中参数用 <code>?</code> 占位。执行时只需传入参数值。</li>
<li><strong>优点</strong>：高效（多次执行同一模板语句时无需重复编译）、安全（参数值会被正确转义）。</li>
<li><strong>示例</strong>：  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into instructor values(?,?,?,?)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pStmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">pStmt.setString(<span class="number">1</span>, <span class="string">&quot;88877&quot;</span>); <span class="comment">// 设置第一个?的值，索引从1开始</span></span><br><span class="line">pStmt.setString(<span class="number">2</span>, <span class="string">&quot;Perry&quot;</span>);</span><br><span class="line">pStmt.setString(<span class="number">3</span>, <span class="string">&quot;Finance&quot;</span>);</span><br><span class="line">pStmt.setInt(<span class="number">4</span>, <span class="number">125000</span>);</span><br><span class="line">pStmt.executeUpdate();</span><br><span class="line"><span class="comment">// 重用同一PreparedStatement插入另一条记录</span></span><br><span class="line">pStmt.setString(<span class="number">1</span>, <span class="string">&quot;88878&quot;</span>);</span><br><span class="line">pStmt.executeUpdate();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-4-元数据检索">1.3.4 元数据检索</h4>
<p>JDBC 允许程序动态探查数据库的结构。</p>
<ul>
<li><strong>结果集元数据</strong> (<code>ResultSetMetaData</code>)：获取查询结果的列信息。  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line"><span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= columnCount; i++) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Column name: &quot;</span> + rsmd.getColumnName(i));</span><br><span class="line">    System.out.println(<span class="string">&quot;Column type: &quot;</span> + rsmd.getColumnTypeName(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><strong>数据库元数据</strong> (<code>DatabaseMetaData</code>)：获取数据库整体信息，如表、列、主键等。  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DatabaseMetaData</span> <span class="variable">dbmd</span> <span class="operator">=</span> conn.getMetaData();</span><br><span class="line"><span class="comment">// 获取指定表的所有列信息</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> dbmd.getColumns(<span class="literal">null</span>, <span class="string">&quot;univdb&quot;</span>, <span class="string">&quot;department&quot;</span>, <span class="string">&quot;%&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">    System.out.println(rs.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>) + <span class="string">&quot;: &quot;</span> + rs.getString(<span class="string">&quot;TYPE_NAME&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取指定表的主键信息</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">pkRs</span> <span class="operator">=</span> dbmd.getPrimaryKeys(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;department&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (pkRs.next()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;PK Seq: &quot;</span> + pkRs.getString(<span class="string">&quot;KEY_SEQ&quot;</span>) +</span><br><span class="line">                       <span class="string">&quot;, Column: &quot;</span> + pkRs.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-5-事务控制">1.3.5 事务控制</h4>
<p>默认情况下，JDBC 处于自动提交模式，每条 SQL 语句都是一个独立的事务。</p>
<ul>
<li><strong>手动管理事务</strong>：  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">conn.setAutoCommit(<span class="literal">false</span>); <span class="comment">// 关闭自动提交</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 执行多条更新语句</span></span><br><span class="line">    stmt.executeUpdate(...);</span><br><span class="line">    stmt.executeUpdate(...);</span><br><span class="line">    conn.commit(); <span class="comment">// 提交事务</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    conn.rollback(); <span class="comment">// 发生错误时回滚</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    conn.setAutoCommit(<span class="literal">true</span>); <span class="comment">// 恢复自动提交</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-6-调用存储过程和函数">1.3.6 调用存储过程和函数</h4>
<p>使用 <code>CallableStatement</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="type">CallableStatement</span> <span class="variable">cStmt1</span> <span class="operator">=</span> conn.prepareCall(<span class="string">&quot;&#123;? = call some_function(?)&#125;&quot;</span>);</span><br><span class="line">cStmt1.registerOutParameter(<span class="number">1</span>, Types.INTEGER); <span class="comment">// 注册输出参数</span></span><br><span class="line">cStmt1.setInt(<span class="number">2</span>, <span class="number">100</span>); <span class="comment">// 设置输入参数</span></span><br><span class="line">cStmt1.execute();</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> cStmt1.getInt(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用存储过程</span></span><br><span class="line"><span class="type">CallableStatement</span> <span class="variable">cStmt2</span> <span class="operator">=</span> conn.prepareCall(<span class="string">&quot;&#123;call some_procedure(?,?)&#125;&quot;</span>);</span><br><span class="line">cStmt2.setString(<span class="number">1</span>, <span class="string">&quot;param1&quot;</span>);</span><br><span class="line">cStmt2.setInt(<span class="number">2</span>, <span class="number">200</span>);</span><br><span class="line">cStmt2.execute();</span><br></pre></td></tr></table></figure>
<h3 id="1-4-ODBC-详解">1.4 ODBC 详解</h3>
<p>ODBC 是一个与编程语言和数据库无关的调用级接口标准。</p>
<h4 id="1-4-1-ODBC-架构">1.4.1 ODBC 架构</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">应用程序 → ODBC API → ODBC 驱动程序管理器 → 特定DB的ODBC驱动 → 数据库</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>驱动程序管理器</strong>：负责加载、卸载驱动程序，并作为应用程序的入口点。</li>
<li><strong>驱动程序</strong>：由数据库厂商提供，负责将标准的 ODBC 调用转换为特定数据库的通信协议。</li>
</ul>
<h4 id="1-4-2-ODBC-C-语言编程示例">1.4.2 ODBC C 语言编程示例</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sqlext.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    RETCODE error; <span class="comment">// 返回码</span></span><br><span class="line">    HENV env;      <span class="comment">// 环境句柄</span></span><br><span class="line">    HDBC conn;     <span class="comment">// 连接句柄</span></span><br><span class="line">    HSTMT stmt;    <span class="comment">// 语句句柄</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 分配环境句柄</span></span><br><span class="line">    SQLAllocEnv(&amp;env);</span><br><span class="line">    <span class="comment">// 2. 分配连接句柄</span></span><br><span class="line">    SQLAllocConnect(env, &amp;conn);</span><br><span class="line">    <span class="comment">// 3. 建立连接</span></span><br><span class="line">    SQLConnect(conn, <span class="string">&quot;db.yale.edu&quot;</span>, SQL_NTS, <span class="string">&quot;avi&quot;</span>, SQL_NTS, <span class="string">&quot;avipasswd&quot;</span>, SQL_NTS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 分配语句句柄</span></span><br><span class="line">    SQLAllocStmt(conn, &amp;stmt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 执行SQL语句</span></span><br><span class="line">    <span class="type">char</span> *sqlquery = <span class="string">&quot;select dept_name, sum(salary) from instructor group by dept_name&quot;</span>;</span><br><span class="line">    error = SQLExecDirect(stmt, sqlquery, SQL_NTS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error == SQL_SUCCESS) &#123;</span><br><span class="line">        <span class="comment">// 6. 绑定结果列到C变量</span></span><br><span class="line">        <span class="type">char</span> deptname[<span class="number">80</span>];</span><br><span class="line">        <span class="type">float</span> salary;</span><br><span class="line">        SQLINTEGER lenOut1, lenOut2;</span><br><span class="line">        SQLBindCol(stmt, <span class="number">1</span>, SQL_C_CHAR, deptname, <span class="number">80</span>, &amp;lenOut1);</span><br><span class="line">        SQLBindCol(stmt, <span class="number">2</span>, SQL_C_FLOAT, &amp;salary, <span class="number">0</span>, &amp;lenOut2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7. 逐行获取结果</span></span><br><span class="line">        <span class="keyword">while</span> (SQLFetch(stmt) == SQL_SUCCESS) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot; %s %g\n&quot;</span>, deptname, salary);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 清理资源</span></span><br><span class="line">    SQLFreeStmt(stmt, SQL_DROP);</span><br><span class="line">    SQLDisconnect(conn);</span><br><span class="line">    SQLFreeConnect(conn);</span><br><span class="line">    SQLFreeEnv(env);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4-3-连接时长管理">1.4.3 连接时长管理</h4>
<ul>
<li>实际数据库平台对客户端连接时长有限制（如默认60秒）。</li>
<li>如果 SQL 查询执行时间超过连接时长，操作会被强行终止。</li>
<li>可通过 ODBC API (<code>SQLSetConnectAttr</code>) 或连接字符串参数调整连接超时设置，以确保长时间操作顺利完成。</li>
</ul>
<h3 id="1-5-嵌入式-SQL-详解">1.5 嵌入式 SQL 详解</h3>
<h4 id="1-5-1-基本概念">1.5.1 基本概念</h4>
<ul>
<li><strong>宿主语言</strong>：嵌入 SQL 语句的通用编程语言，如 C、COBOL。</li>
<li><strong>工作原理</strong>：源代码通过预处理器，将嵌入式 SQL 语句转换为对数据库运行时库的函数调用，然后再由宿主语言编译器编译。</li>
<li><strong>优点</strong>：结合了 SQL 强大的数据操作能力和宿主语言的计算、流程控制能力。</li>
</ul>
<h4 id="1-5-2-语法与示例">1.5.2 语法与示例</h4>
<ul>
<li><strong>声明共享变量</strong>：宿主语言变量需在特殊声明节中声明，并在 SQL 语句前加冒号 (<code>:</code>) 引用。  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">BEGIN</span> <span class="keyword">DECLARE</span> SECTION;</span><br><span class="line">    <span class="type">int</span> credit_amount;</span><br><span class="line">    <span class="type">char</span> si[<span class="number">5</span>];</span><br><span class="line">    <span class="type">char</span> sn[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">END</span> <span class="keyword">DECLARE</span> SECTION;</span><br></pre></td></tr></table></figure>
</li>
<li><strong>连接数据库</strong>：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">CONNECT</span> <span class="keyword">TO</span> server <span class="keyword">USER</span> user_name <span class="keyword">USING</span> password;</span><br></pre></td></tr></table></figure>
</li>
<li><strong>静态 SQL 查询与游标</strong>：当查询返回多行结果时，必须使用游标。  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 声明游标</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">DECLARE</span> c <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">    <span class="keyword">SELECT</span> ID, name <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> tot_cred <span class="operator">&gt;</span> :credit_amount;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 打开游标（执行查询）</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">OPEN</span> c;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 循环获取数据</span><br><span class="line">while (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">FETCH</span> c <span class="keyword">INTO</span> :si, :sn;</span><br><span class="line">    if (sqlca.sqlcode <span class="operator">!=</span> <span class="number">0</span>) break; <span class="operator">/</span><span class="operator">/</span> 使用 SQLCA 检查状态</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 处理 si, sn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 关闭游标</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">CLOSE</span> c;</span><br></pre></td></tr></table></figure>
</li>
<li><strong>通过游标更新数据</strong>：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">DECLARE</span> c <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Music&#x27;</span></span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>; <span class="operator">/</span><span class="operator">/</span> 声明为可更新游标</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">OPEN</span> c;</span><br><span class="line">while (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">FETCH</span> c <span class="keyword">INTO</span> ...;</span><br><span class="line">    if (no_more_data) break;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 更新当前游标指向的行</span><br><span class="line">    <span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">UPDATE</span> instructor</span><br><span class="line">             <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">1000</span></span><br><span class="line">             <span class="keyword">WHERE</span> <span class="keyword">CURRENT</span> <span class="keyword">OF</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">CLOSE</span> c;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="第二章：SQL-函数与存储过程">第二章：SQL 函数与存储过程</h2>
<h3 id="2-1-SQL-函数">2.1 SQL 函数</h3>
<p>函数是接受参数、执行计算并返回一个标量值的命名程序单元。</p>
<h4 id="2-1-1-创建-SQL-标量函数">2.1.1 创建 SQL 标量函数</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个返回指定部门教师人数的函数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dept_count(dept_name <span class="type">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INTEGER</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> d_count <span class="type">INTEGER</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> d_count</span><br><span class="line">    <span class="keyword">FROM</span> instructor</span><br><span class="line">    <span class="keyword">WHERE</span> instructor.dept_name <span class="operator">=</span> dept_count.dept_name;</span><br><span class="line">    <span class="keyword">RETURN</span> d_count;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>说明</strong>：
<ul>
<li><code>RETURNS</code> 指定返回值的类型。</li>
<li><code>BEGIN ... END</code> 定义函数体。</li>
<li><code>DECLARE</code> 用于声明局部变量。</li>
<li><code>SELECT ... INTO</code> 将查询结果赋值给变量。</li>
<li><code>RETURN</code> 语句返回值。</li>
</ul>
</li>
</ul>
<h4 id="2-1-2-使用-SQL-函数">2.1.2 使用 SQL 函数</h4>
<p>函数可以在 SQL 语句中像内置函数一样使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询教师人数超过12人的院系及其预算</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, budget</span><br><span class="line"><span class="keyword">FROM</span> department</span><br><span class="line"><span class="keyword">WHERE</span> dept_count(dept_name) <span class="operator">&gt;</span> <span class="number">12</span>;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-SQL-存储过程">2.2 SQL 存储过程</h3>
<p>存储过程与函数类似，但通常不直接返回值，而是通过输出参数返回结果，并且可以执行更复杂的操作，包括数据修改。</p>
<h4 id="2-2-1-创建存储过程">2.2.1 创建存储过程</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dept_count_proc(</span><br><span class="line">    <span class="keyword">IN</span> dept_name <span class="type">VARCHAR</span>(<span class="number">20</span>),   <span class="comment">-- 输入参数</span></span><br><span class="line">    <span class="keyword">OUT</span> d_count <span class="type">INTEGER</span>         <span class="comment">-- 输出参数</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> d_count</span><br><span class="line">    <span class="keyword">FROM</span> instructor</span><br><span class="line">    <span class="keyword">WHERE</span> instructor.dept_name <span class="operator">=</span> dept_count_proc.dept_name;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-调用存储过程">2.2.2 调用存储过程</h4>
<ul>
<li><strong>从嵌入式 SQL 中调用</strong>：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">BEGIN</span> <span class="keyword">DECLARE</span> SECTION;</span><br><span class="line">    <span class="type">integer</span> d_count;</span><br><span class="line">    <span class="type">char</span> dept_name[] <span class="operator">=</span> &quot;Physics&quot;;</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">END</span> <span class="keyword">DECLARE</span> SECTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">CALL</span> dept_count_proc(:dept_name, :d_count);</span><br></pre></td></tr></table></figure>
</li>
<li><strong>从动态 SQL (JDBC/CallableStatement) 中调用</strong>：如前文 JDBC 部分所示。</li>
<li><strong>从 SQL 脚本或其他过程中调用</strong>：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> d_count <span class="type">INTEGER</span>;</span><br><span class="line"><span class="keyword">CALL</span> dept_count_proc(<span class="string">&#x27;Physics&#x27;</span>, d_count);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-3-优势与存储">2.3 优势与存储</h3>
<ul>
<li><strong>预编译与优化</strong>：函数和存储过程在创建时即被编译和优化，生成执行计划并存储在数据库字典中。</li>
<li><strong>性能提升</strong>：应用程序调用时无需重复进行语法分析、优化，直接执行，效率高。</li>
<li><strong>减少网络流量</strong>：将复杂逻辑在数据库端执行，只返回结果，避免了大量中间数据的传输。</li>
<li><strong>代码重用与封装</strong>：业务逻辑被封装在数据库中，可供多个应用程序共享，保证一致性。</li>
</ul>
<h2 id="第三章：触发器">第三章：触发器</h2>
<h3 id="3-1-触发器概述">3.1 触发器概述</h3>
<h4 id="3-1-1-定义与模型">3.1.1 定义与模型</h4>
<p>触发器是一种特殊的存储过程，它<strong>自动响应</strong>数据库表上的特定数据修改事件（<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>），并根据预定义的条件执行相应的动作。</p>
<ul>
<li><strong>事件</strong>：引发触发器执行的操作（插入、更新、删除）。</li>
<li><strong>条件</strong>：（可选）一个布尔表达式，当条件为真时，触发器动作才执行。</li>
<li><strong>动作</strong>：触发器要执行的一系列 SQL 语句，用于实现数据检查、完整性维护或业务逻辑。</li>
</ul>
<h4 id="3-1-2-语法概览">3.1.2 语法概览</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line">&#123;BEFORE <span class="operator">|</span> AFTER&#125; &#123;<span class="keyword">INSERT</span> <span class="operator">|</span> <span class="keyword">UPDATE</span> <span class="operator">|</span> <span class="keyword">DELETE</span> <span class="operator">|</span> <span class="keyword">UPDATE</span> <span class="keyword">OF</span> column_list&#125;</span><br><span class="line"><span class="keyword">ON</span> table_name</span><br><span class="line">[<span class="keyword">REFERENCING</span> &#123;<span class="keyword">OLD</span> [<span class="type">ROW</span>] [<span class="keyword">AS</span>] old_name <span class="operator">|</span> <span class="keyword">NEW</span> [<span class="type">ROW</span>] [<span class="keyword">AS</span>] new_name</span><br><span class="line">             <span class="operator">|</span> <span class="keyword">OLD</span> <span class="keyword">TABLE</span> [<span class="keyword">AS</span>] old_table_name <span class="operator">|</span> <span class="keyword">NEW</span> <span class="keyword">TABLE</span> [<span class="keyword">AS</span>] new_table_name&#125;]</span><br><span class="line">[<span class="keyword">FOR</span> <span class="keyword">EACH</span> &#123;<span class="type">ROW</span> <span class="operator">|</span> STATEMENT&#125;]</span><br><span class="line">[<span class="keyword">WHEN</span> (<span class="keyword">condition</span>)]</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="comment">-- 触发动作体 (SQL 语句)</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-行级触发器">3.2 行级触发器</h3>
<p>行级触发器对受事件影响的每一行都执行一次触发动作。</p>
<h4 id="3-2-1-引用新旧行值">3.2.1 引用新旧行值</h4>
<p>在触发器体内，可以引用被修改行的旧值和新值。</p>
<ul>
<li><code>REFERENCING OLD ROW AS</code>：用于 <code>DELETE</code> 和 <code>UPDATE</code> 操作，引用修改前的行。</li>
<li><code>REFERENCING NEW ROW AS</code>：用于 <code>INSERT</code> 和 <code>UPDATE</code> 操作，引用修改后的行。</li>
</ul>
<h4 id="3-2-2-应用示例">3.2.2 应用示例</h4>
<ol>
<li>
<p><strong>数据清洗（<code>BEFORE</code> 触发器）</strong>：在插入或更新前修正数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> setnull_trigger BEFORE <span class="keyword">UPDATE</span> <span class="keyword">OF</span> grade <span class="keyword">ON</span> takes</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> nrow</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">WHEN</span> (nrow.grade <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>)  <span class="comment">-- 当新成绩为空字符串时</span></span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="keyword">SET</span> nrow.grade <span class="operator">=</span> <span class="keyword">NULL</span>; <span class="comment">-- 将其设置为 NULL</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p><em>说明：此触发器在 <code>takes</code> 表的 <code>grade</code> 列被更新前触发。如果新值是空字符串，则将其改为 <code>NULL</code>。<code>BEFORE</code> 触发器可以修改即将写入数据库的新值。</em></p>
</li>
<li>
<p><strong>维护参照完整性（复杂检查）</strong>：实现比外键约束更复杂的关联规则。</p>
<ul>
<li><strong>示例1：插入<code>section</code>时检查<code>time_slot_id</code>有效性</strong>。  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> timeslot_check1 AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> section</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> nrow</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">WHEN</span> (nrow.time_slot_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> time_slot_id <span class="keyword">FROM</span> timeslot))</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span>; <span class="comment">-- 回滚整个插入事务</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<em>说明：当尝试插入一个<code>time_slot_id</code>不在<code>timeslot</code>表中的<code>section</code>记录时，事务被回滚。</em></li>
<li><strong>示例2：删除<code>timeslot</code>时防止孤立引用</strong>。  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> timeslot_check2 AFTER <span class="keyword">DELETE</span> <span class="keyword">ON</span> timeslot</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">OLD</span> <span class="type">ROW</span> <span class="keyword">AS</span> orow</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">WHEN</span> (</span><br><span class="line">    <span class="comment">-- 被删除的time_slot_id是timeslot表中该ID的最后一条记录</span></span><br><span class="line">    orow.time_slot_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> time_slot_id <span class="keyword">FROM</span> timeslot)</span><br><span class="line">    <span class="keyword">AND</span></span><br><span class="line">    <span class="comment">-- 并且该ID仍在section表中被引用</span></span><br><span class="line">    orow.time_slot_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> time_slot_id <span class="keyword">FROM</span> section)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<em>说明：防止删除一个正在被<code>section</code>表使用的<code>time_slot_id</code>，且确保它是该ID的最后一个实例。</em></li>
</ul>
</li>
<li>
<p><strong>维护派生数据（自动更新）</strong>：保持数据间的一致性。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> credits_earned AFTER <span class="keyword">UPDATE</span> <span class="keyword">OF</span> grade <span class="keyword">ON</span> takes</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> nrow</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">OLD</span> <span class="type">ROW</span> <span class="keyword">AS</span> orow</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">WHEN</span> (nrow.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">AND</span> nrow.grade <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">      <span class="keyword">AND</span> (orow.grade <span class="operator">=</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">OR</span> orow.grade <span class="keyword">IS</span> <span class="keyword">NULL</span>))</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="keyword">UPDATE</span> student</span><br><span class="line">    <span class="keyword">SET</span> tot_cred <span class="operator">=</span> tot_cred <span class="operator">+</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> credits</span><br><span class="line">        <span class="keyword">FROM</span> course</span><br><span class="line">        <span class="keyword">WHERE</span> course.course_id <span class="operator">=</span> nrow.course_id</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">WHERE</span> student.ID <span class="operator">=</span> nrow.ID;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p><em>说明：当学生某门课的成绩从不通过(<code>F</code>)或空变为通过（非<code>F</code>且非空）时，自动将该课程的学分累加到学生的总学分(<code>tot_cred</code>)中。</em></p>
</li>
</ol>
<h3 id="3-3-语句级触发器">3.3 语句级触发器</h3>
<p>语句级触发器在每个触发事件（<code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>）上只执行一次，无论该语句影响了多少行。</p>
<ul>
<li><strong>语法</strong>：使用 <code>FOR EACH STATEMENT</code>（这是默认值）。</li>
<li><strong>引用过渡表</strong>：可以使用 <code>REFERENCING OLD TABLE AS</code> 或 <code>REFERENCING NEW TABLE AS</code> 来引用被该语句影响的所有行的旧值或新值的集合（过渡表）。</li>
<li><strong>适用场景</strong>：当触发动作不依赖于具体每一行的数据，或者需要对所有受影响的行进行批量操作时，语句级触发器比行级触发器更高效。  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> log_salary_change AFTER <span class="keyword">UPDATE</span> <span class="keyword">ON</span> instructor</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">OLD</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> old_table</span><br><span class="line">            <span class="keyword">NEW</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> new_table</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> STATEMENT</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> salary_audit_log(change_time, old_avg, new_avg)</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">           <span class="built_in">AVG</span>(old_table.salary),</span><br><span class="line">           <span class="built_in">AVG</span>(new_table.salary)</span><br><span class="line">    <span class="keyword">FROM</span> old_table, new_table; <span class="comment">-- 注意：过渡表需在FROM子句中引用</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-4-触发器的适用与不适用场景">3.4 触发器的适用与不适用场景</h3>
<h4 id="3-4-1-适用场景">3.4.1 适用场景</h4>
<ul>
<li><strong>实现复杂的业务规则或完整性约束</strong>，这些约束无法通过标准的 <code>CHECK</code>、<code>UNIQUE</code>、<code>FOREIGN KEY</code> 约束来表达。</li>
<li><strong>审计与日志记录</strong>：自动记录数据变更（谁、何时、改了哪些数据）。</li>
<li><strong>维护衍生或汇总数据</strong>（尽管现在有更好的选择，见下文）。</li>
<li><strong>数据同步与复制</strong>（在早期技术中）。</li>
</ul>
<h4 id="3-4-2-不适用-慎用场景（现代最佳实践）">3.4.2 不适用/慎用场景（现代最佳实践）</h4>
<ol>
<li><strong>维护汇总数据</strong>：
<ul>
<li><strong>旧方式</strong>：用触发器在每次数据变更时更新汇总表（如部门总工资）。</li>
<li><strong>现代方式</strong>：使用 <strong>物化视图</strong>。数据库系统可以自动、高效地维护物化视图的更新，通常比手写触发器更可靠、性能更好。</li>
</ul>
</li>
<li><strong>数据库复制</strong>：
<ul>
<li><strong>旧方式</strong>：用触发器将变更记录到“增量表”，再由其他进程应用。</li>
<li><strong>现代方式</strong>：使用数据库内置的<strong>复制功能</strong>（如日志传输、逻辑复制），这些功能更健壮、对性能影响更小。</li>
</ul>
</li>
<li><strong>简单的数据有效性检查</strong>：
<ul>
<li><strong>首选</strong>：应尽量使用声明式的<strong>完整性约束</strong>（<code>NOT NULL</code>, <code>CHECK</code>, <code>FOREIGN KEY</code>）。约束更易于声明、理解和维护，且通常由 DBMS 更高效地执行。</li>
</ul>
</li>
<li><strong>过度复杂的业务逻辑</strong>：
<ul>
<li><strong>问题</strong>：将大量复杂逻辑放入触发器可能导致“逻辑黑洞”，使得数据变更行为难以理解和调试，也增加了应用与数据库的耦合度。</li>
<li><strong>建议</strong>：考虑将核心业务逻辑放在应用层或中间件，数据库主要负责数据存储和基本完整性。</li>
</ul>
</li>
</ol>
<h3 id="3-5-总结">3.5 总结</h3>
<p>触发器是基于事件-条件-动作模型的强大工具，是实现复杂数据完整性规则和自动化业务逻辑的有效手段。然而，在现代数据库系统中，应优先考虑使用声明式约束和内置功能（如物化视图、复制）来满足需求。当必须使用触发器时，应谨慎设计，确保其逻辑清晰、高效，并做好充分文档记录，以避免维护的复杂性。</p>
<hr>
<h2 id="本章总结">本章总结</h2>
<p>第五章“高级SQL”将SQL的能力从单纯的数据查询操作扩展到与应用程序的深度集成以及数据库内部的程序化逻辑。</p>
<ol>
<li><strong>SQL与编程语言集成</strong>：掌握了通过<strong>JDBC</strong> (Java)、<strong>ODBC</strong> (C/C++) 和<strong>嵌入式SQL</strong>从应用程序中连接、查询和操作数据库的核心模式与技术细节。理解连接管理、事务控制、预编译语句和元数据访问是构建健壮数据库应用的基础。</li>
<li><strong>数据库端程序化逻辑</strong>：学会了在数据库服务器内部创建可重用的逻辑单元——<strong>函数</strong>（返回标量值）和<strong>存储过程</strong>（执行操作，可通过参数返回结果）。它们提高了代码复用性、减少了网络开销，并允许将业务逻辑封装在数据层。</li>
<li><strong>自动化响应机制</strong>：深入理解了<strong>触发器</strong>这一基于事件-条件-动作模型的强大工具。能够创建行级和语句级触发器，用于实现复杂的数据完整性约束、自动维护衍生数据、记录审计日志等。同时，也认识到应优先使用声明式约束和现代数据库内置功能，仅在必要时谨慎使用触发器。</li>
</ol>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/my_avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/my_avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Yuejin Wu</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/')">高级SQL 简读</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=高级SQL 简读&amp;url=http://example.com/2025/12/24/DB_%E9%AB%98%E7%BA%A7SQL%E7%AE%80%E8%AF%BB/&amp;pic=/img/SQL_cover.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Yuejin's Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>数据库<span class="categoryesPageCount">12</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Database/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Database<span class="tagsPageCount">12</span></a><a class="post-meta__box__tags" href="/tags/SQL/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>SQL<span class="tagsPageCount">6</span></a></div></div><div class="post_share"><div class="social-share" data-image="/img/C7_cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/"><img class="prev-cover" src="/img/SQL_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">§3 Intro-to-SQL 简读</div></div></a></div><div class="next-post pull-right"><a href="/2025/12/24/DB_AdvancedSQL/"><img class="next-cover" src="/img/SQL_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">§5 Advanced-SQL课件详解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/12/26/DB_E-R%20Model/" title="§6 E-R Model 解读"><img class="cover" src="/img/ER_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-26</div><div class="title">§6 E-R Model 解读</div></div></a></div><div><a href="/2025/12/24/DB_Intermediate%20SQL/" title="§4 Intermediate-SQL 解读"><img class="cover" src="/img/SQL_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-24</div><div class="title">§4 Intermediate-SQL 解读</div></div></a></div><div><a href="/2025/12/24/DB_AdvancedSQL/" title="§5 Advanced-SQL课件详解"><img class="cover" src="/img/SQL_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-24</div><div class="title">§5 Advanced-SQL课件详解</div></div></a></div><div><a href="/2025/12/26/DB_Schema%20Normalization-Relational%20Database%20Design/" title="§7 Schema Normalization-Relational Database Design 解读"><img class="cover" src="/img/SN_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-26</div><div class="title">§7 Schema Normalization-Relational Database Design 解读</div></div></a></div><div><a href="/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/" title="§3 Intro-to-SQL 简读"><img class="cover" src="/img/SQL_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-22</div><div class="title">§3 Intro-to-SQL 简读</div></div></a></div><div><a href="/2025/12/28/DB_QueryOptim/" title="§16 Query Optimization 解读"><img class="cover" src="/img/C7_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-28</div><div class="title">§16 Query Optimization 解读</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src="/img/my_avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div class="author-intro" style="line-height: 1.7; text-align: center; font-family: inherit; margin-top: -0.5rem; margin-bottom: 0.5rem;">
  <p style="font-size: 1.15rem; margin-bottom: 0.8rem; font-weight: 500; color: var(--anzhiyu-fontcolor);">你好，我是 <span style="color: #00ffcc; font-weight: 600; text-shadow: 0 0 5px #00ffccaa;">Yuejin Wu</span>！👋</p>
  <p style="font-size: 1.05rem; margin-bottom: 0.6rem; opacity: 0.9; color: var(--anzhiyu-fontcolor);">BUPT 本科生 · 人工智能专业</p>
  <p style="font-size: 1.05rem; margin-bottom: 1rem; opacity: 0.9; color: var(--anzhiyu-fontcolor);">记录学习、思考与生活</p>
  <p style="font-size: 1.1rem; margin-top: 1rem; padding-top: 0.8rem; border-top: 1px solid var(--anzhiyu-theme-op); font-weight: 600; color: #FF0066; text-shadow: 0 0 5px #FF0066, 0 0 5px #FF0066aa;">
   保持好奇，持续探索
  </p>
</div>
</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Yuejin Wu</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/YuejinWu/YuejinWu.github.io" target="_blank" title="Github"></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E4%BB%8E%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E8%AE%BF%E9%97%AE-SQL"><span class="toc-number">1.</span> <span class="toc-text">第一章：从编程语言访问 SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%A6%82%E8%BF%B0%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 概述：数据库应用系统架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%AE%BF%E9%97%AE-SQL-%E7%9A%84%E4%B8%A4%E7%A7%8D%E4%B8%BB%E8%A6%81%E9%80%94%E5%BE%84"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 访问 SQL 的两种主要途径</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E5%8A%A8%E6%80%81-SQL"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 动态 SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E5%B5%8C%E5%85%A5%E5%BC%8F-SQL"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 嵌入式 SQL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-JDBC-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 JDBC 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-JDBC-%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1 JDBC 核心编程模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E4%B8%8E%E6%AD%A5%E9%AA%A4%E8%A7%A3%E6%9E%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2 关键组件与步骤解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E9%A2%84%E7%BC%96%E8%AF%91%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3 预编译语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-%E5%85%83%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4 元数据检索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-5-%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">1.3.5.</span> <span class="toc-text">1.3.5 事务控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-6-%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.6.</span> <span class="toc-text">1.3.6 调用存储过程和函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-ODBC-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 ODBC 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-ODBC-%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1 ODBC 架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-ODBC-C-%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2 ODBC C 语言编程示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-%E8%BF%9E%E6%8E%A5%E6%97%B6%E9%95%BF%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.3.</span> <span class="toc-text">1.4.3 连接时长管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%B5%8C%E5%85%A5%E5%BC%8F-SQL-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 嵌入式 SQL 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1 基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-%E8%AF%AD%E6%B3%95%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2 语法与示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9ASQL-%E5%87%BD%E6%95%B0%E4%B8%8E%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">第二章：SQL 函数与存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-SQL-%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 SQL 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%88%9B%E5%BB%BA-SQL-%E6%A0%87%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 创建 SQL 标量函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E4%BD%BF%E7%94%A8-SQL-%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 使用 SQL 函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-SQL-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 SQL 存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 创建存储过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 调用存储过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BC%98%E5%8A%BF%E4%B8%8E%E5%AD%98%E5%82%A8"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 优势与存储</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">第三章：触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%A7%A6%E5%8F%91%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 触发器概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E5%AE%9A%E4%B9%89%E4%B8%8E%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 定义与模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E8%AF%AD%E6%B3%95%E6%A6%82%E8%A7%88"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 语法概览</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E8%A1%8C%E7%BA%A7%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 行级触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%BC%95%E7%94%A8%E6%96%B0%E6%97%A7%E8%A1%8C%E5%80%BC"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 引用新旧行值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 应用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E8%AF%AD%E5%8F%A5%E7%BA%A7%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 语句级触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E9%80%82%E7%94%A8%E4%B8%8E%E4%B8%8D%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 触发器的适用与不适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E4%B8%8D%E9%80%82%E7%94%A8-%E6%85%8E%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%88%E7%8E%B0%E4%BB%A3%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%89"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 不适用&#x2F;慎用场景（现代最佳实践）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E6%80%BB%E7%BB%93"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">本章总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/28/DB_Transaction/" title="§17 Transaction 解读"><img src="/img/C7_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="§17 Transaction 解读"/></a><div class="content"><a class="title" href="/2025/12/28/DB_Transaction/" title="§17 Transaction 解读">§17 Transaction 解读</a><time datetime="2025-12-27T17:32:13.329Z" title="发表于 2025-12-28 01:32:13">2025-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/28/DB_QueryOptim/" title="§16 Query Optimization 解读"><img src="/img/C7_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="§16 Query Optimization 解读"/></a><div class="content"><a class="title" href="/2025/12/28/DB_QueryOptim/" title="§16 Query Optimization 解读">§16 Query Optimization 解读</a><time datetime="2025-12-27T17:13:55.730Z" title="发表于 2025-12-28 01:13:55">2025-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/28/DB_QueryProcessing/" title="§15 Query Processing 简读"><img src="/img/C7_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="§15 Query Processing 简读"/></a><div class="content"><a class="title" href="/2025/12/28/DB_QueryProcessing/" title="§15 Query Processing 简读">§15 Query Processing 简读</a><time datetime="2025-12-27T16:13:06.413Z" title="发表于 2025-12-28 00:13:06">2025-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/27/DB_Indexing/" title="§14 Indexing 解读"><img src="/img/C7_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="§14 Indexing 解读"/></a><div class="content"><a class="title" href="/2025/12/27/DB_Indexing/" title="§14 Indexing 解读">§14 Indexing 解读</a><time datetime="2025-12-27T13:25:49.244Z" title="发表于 2025-12-27 21:25:49">2025-12-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/27/DB_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/" title="§13 Data Storage Structures 简读"><img src="/img/C7_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="§13 Data Storage Structures 简读"/></a><div class="content"><a class="title" href="/2025/12/27/DB_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/" title="§13 Data Storage Structures 简读">§13 Data Storage Structures 简读</a><time datetime="2025-12-27T08:01:17.698Z" title="发表于 2025-12-27 16:01:17">2025-12-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="Yuejin Wu" target="_blank">Yuejin Wu</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" href="/" title="首页">首页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://hexo.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI-Platform/" style="font-size: 0.88rem;">AI Platform<sup>1</sup></a><a href="/tags/Database/" style="font-size: 0.88rem;">Database<sup>12</sup></a><a href="/tags/English/" style="font-size: 0.88rem;">English<sup>1</sup></a><a href="/tags/RNN/" style="font-size: 0.88rem;">RNN<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>6</sup></a><a href="/tags/Self-Attention/" style="font-size: 0.88rem;">Self Attention<sup>1</sup></a><a href="/tags/plan/" style="font-size: 0.88rem;">plan<sup>2</sup></a><a href="/tags/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/" style="font-size: 0.88rem;">关系模型<sup>1</sup></a><a href="/tags/%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B/" style="font-size: 0.88rem;">自注意力<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.7.0",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Yuejin Wu 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>