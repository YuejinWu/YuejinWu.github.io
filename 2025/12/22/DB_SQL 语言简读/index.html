<!DOCTYPE html><html lang="en &amp;&amp; zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Intro-to-SQL 简读 | Yuejin's Blog</title><meta name="keywords" content="Database,SQL"><meta name="author" content="Yuejin Wu"><meta name="copyright" content="Yuejin Wu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Intro-to-SQL 简读"><meta name="application-name" content="Intro-to-SQL 简读"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Intro-to-SQL 简读"><meta property="og:url" content="http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/index.html"><meta property="og:site_name" content="Yuejin's Blog"><meta property="og:description" content="一、SQL概述（Overview of SQL）1.1 SQL的基本概念SQL (Structured Query Language) 是一种结构化查询语言，是使用最广泛的数据库查询语言。它已经扩展到其他领域，例如大数据（BigData）处理。 1.2 SQL的组成部分SQL由以下几个主要部分组成："><meta property="og:locale" content="en &amp;&amp; zh-Hans"><meta property="og:image" content="http://example.com/img/db_cover.png"><meta property="article:author" content="Yuejin Wu"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/db_cover.png"><meta name="description" content="一、SQL概述（Overview of SQL）1.1 SQL的基本概念SQL (Structured Query Language) 是一种结构化查询语言，是使用最广泛的数据库查询语言。它已经扩展到其他领域，例如大数据（BigData）处理。 1.2 SQL的组成部分SQL由以下几个主要部分组成："><link rel="shortcut icon" href="/img/mylogo.jpg"><link rel="canonical" href="http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":null,"LingQueMonitorID":null},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Yuejin Wu","link":"链接: ","source":"来源: Yuejin's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Yuejin's Blog',
  title: 'Intro-to-SQL 简读',
  postAI: '',
  pageFillDescription: '一、SQL概述（Overview of SQL）, 1.1 SQL的基本概念, 1.2 SQL的组成部分, 二、SQL数据定义（DDL）, 2.1 DDL的功能, 2.2 域类型（Domain Types）, 2.3 创建表（Create Table）, 2.4 完整性约束（Integrity Constraints）, 2.5 模式更新（Schema Updates）, 三、SQL查询基本结构, 3.1 基本查询形式, 3.2 SELECT子句详解, 3.3 WHERE子句详解, 3.4 FROM子句详解, 3.5 自然连接（Natural Join）, 四、SQL查询的计算过程, 4.1 完整的SELECT语法, 4.2 查询执行顺序, 五、其他基本操作, 5.1 重命名操作（RENAME）, 5.2 字符串操作, 5.3 结果排序（ORDER BY）, 六、集合操作（Set Operations）, 6.1 基本集合操作, 6.2 UNION（并集）, 6.3 INTERSECT（交集）, 6.4 EXCEPT（差集）, 七、空值处理（NULL Values）, 7.1 NULL的含义, 7.2 算术运算与NULL, 7.3 检查NULL值, 7.4 比较运算与NULL, 7.5 布尔运算与UNKNOWN, 八、聚合函数（Aggregate Functions）, 8.1 基本聚合函数, 8.2 聚合函数语法, 8.3 基本聚合示例, 8.4 GROUP BY子句, 8.5 HAVING子句, 九、嵌套子查询（Nested Subqueries）, 9.1 基本概念, 9.2 集合成员资格（Set Membership）, 9.3 集合比较 - SOME子句, 9.4 集合比较 - ALL子句, 9.5 测试空关系 - EXISTS, 9.6 NOT EXISTS的使用, 9.7 测试重复元组 - UNIQUE, 9.8 FROM子句中的子查询, 9.9 WITH子句（推荐使用）, 9.10 标量子查询（Scalar Subquery）, 十、数据库修改（Database Modification）, 10.1 删除操作（DELETE）, 10.2 插入操作（INSERT）, 10.3 更新操作（UPDATE）, 10.4 条件更新 - CASE语句, 10.5 使用标量子查询更新, 10.6 多表更新, 十一、重要实践建议, 11.1 命名规范, 11.2 性能优化建议, 总结一概述的基本概念是一种结构化查询语言是使用最广泛的数据库查询语言它已经扩展到其他领域例如大数据处理的组成部分由以下几个主要部分组成数据操作语言查询检索信息的能力对元组进行选择插入删除更新操作主要命令数据定义语言对模式视图和索引进行定义删除修改主要命令完整性约束指定完整性约束的命令视图定义定义视图的命令事务控制指定事务开始和结束的命令主要命令嵌入式和动态嵌入在编程语言中的语句授权主要命令二数据定义的功能允许对关系进行以下规范每个关系的模式与每个属性关联的值类型完整性约束如为每个关系维护的索引每个关系的安全和授权信息每个关系在磁盘上的物理存储结构域类型基本数据类型固定长度字符串用户指定长度可变长度字符串用户指定最大长度整数依赖于机器小整数整数的机器依赖子集定点数精度总位数小数点右侧的位数例如可以精确存储日期和时间类型日期包含年位月日例如时间包含小时分钟秒例如或日期加时间例如时间间隔两个日期时间时间戳相减得到间隔值例如间隔值可以加到日期时间时间戳值上空值处理所有域类型都允许空值声明属性为可以禁止该属性为空值用户自定义类型创建表基本语法其中是关系名称是属性名是属性的数据类型示例完整性约束主要约束类型主键约束外键约束非空约束完整示例复合主键示例模式更新删除表添加属性是要添加的属性名是属性的域所有现有元组的新属性值被赋为例如删除属性是要删除的属性名例如注意许多数据库不支持删除属性性能考虑表中的元组按行存储添加属性或删除表会导致昂贵的记录修改和移动操作数据库和大数据系统采用列式存储以优化此类操作三查询基本结构基本查询形式标准查询结构其中表示属性表示关系是谓词条件查询结果是一个关系等价的关系代数表达式子句详解基本功能子句列出属性对应关系代数的投影操作示例查询所有教师姓名大小写不敏感去除重复保留重复是默认选项使用星号选择所有属性实际应用中应避免使用可能导致索引失效字面量无子句结果单列单行值为给列命名有子句结果行表的行数每行值为算术表达式使用重命名子句详解基本功能子句指定结果必须满足的条件对应关系代数的选择谓词逻辑连接词与或非比较运算符不等于示例单条件查询示例复合条件查询运算符查找工资在到之间的教师等价于元组比较运算符子句详解基本功能子句列出关系对应关系代数的笛卡尔积操作笛卡尔积生成每个配对包含两个关系的所有属性对于共同属性如在结果表中使用关系名重命名重要注意事项当子句包含多个关系时必须在子句中加入连接条件防止产生代价高昂的多表笛卡尔积操作频繁执行的查询子句的表个数不要过多不超过个表如需查询涉及张表考虑将这些表的数据进行合并连接查询示例查找所有教过课的教师姓名和课程添加部门筛选自然连接语法对比传统连接自然连接自动匹配两个关系中所有同名属性四查询的计算过程完整的语法查询执行顺序和阶段从子句列出的基表或视图中选择满足条件的元组从这些元组中选择属性形成结果表和聚合函数阶段根据条件表达式对结果表进行分组对每个组执行组聚合函数输出每个组作为结果阶段对分组结果进行筛选输出满足条件的组阶段对结果表或组按降序或升序排序五其他基本操作重命名操作使用子句重命名关系和属性示例找出所有工资高于计算机科学系教师的教师姓名使用元组变量和区分同一关系的不同实例关键字是可选的为什么需要元组变量涉及对关系中属性的不同值的比较利用和区分不同的实例实现了对同一属性的不同值的比较字符串操作模式匹配运算符特殊字符百分号匹配任意子串下划线匹配任意单个字符示例查找姓名中包含的所有教师匹配字符串使用反斜杠作为转义字符模式示例匹配以开头的任意字符串匹配包含作为子串的任意字符串匹配恰好三个字符的字符串匹配至少三个字符的字符串注意模式是大小写敏感的其他字符串操作连接使用大小写转换查找字符串长度提取子串等结果排序基本排序按字母顺序列出所有教师姓名指定排序方向降序升序默认多属性排序不同属性不同排序方向性能警告避免使用数据库的操作对大数据文件进行排序这可能导致严重的性能问题六集合操作基本集合操作支持三种集合操作并集交集差集特点自动消除重复要保留重复使用并集示例查找年秋季或年春季开设的课程交集示例查找既在年秋季又在年春季开设的课程差集示例查找年秋季开设但年春季没有开设的课程七空值处理的含义表示未知值值不存在算术运算与任何涉及的算术表达式结果都是例如检查值使用谓词查找工资为的所有教师比较运算与将涉及的任何比较结果视为未知布尔运算与运算运算子句处理如果子句的谓词求值为则视为实际应用建议避免引入属性值防止索引失效使用默认值替代八聚合函数基本聚合函数聚合函数对列的值进行操作但返回单个值平均值最小值最大值求和计数聚合函数语法其中定义在的所有属性上定义在上作为的约束基本聚合示例示例计算平均工资示例计算教师数量示例计算元组数量子句功能将结果按指定属性分组示例查找每个系的平均工资重要规则子句中在聚合函数外的属性必须出现在列表中错误示例错误不在中值处理除了外所有聚合操作都忽略聚合属性上的值元组子句功能对分组形成后的结果应用条件示例查找平均工资超过的所有系的名称和平均工资在形成分组之前应用谓词在形成分组之后应用谓词九嵌套子查询基本概念子查询是嵌套在另一个查询中的表达式可以出现的位置子句可以被任何有效的子查询替换子句可以被表达式替换子句可以被生成单个值的子查询替换优化建议从优化角度避免使用低效的嵌套查询改为子句中的多表连接便于查询优化集合成员资格运算符示例查找年秋季和年春季都开设的课程运算符示例查找年秋季开设但年春季未开设的课程执行过程从头至尾依次扫描中每一行对每一行判断其是否满足查询条件执行嵌入在子句中的查询判断本行的是否在结果集合中性能问题嵌入式查询可能执行效率较低被嵌入的子句可能多次重复执行实际应用中应尽量避免等嵌入式查询改进方案多表连接低效的嵌套查询高效的多表连接根据课件中的执行计划性能比为嵌套查询更慢其他用法名字不是也不是的教师元组集合比较子句示例查找工资高于生物系至少一名教师的教师姓名方法使用元组变量方法使用的定义其中可以是示例因为因为因为重要等价关系但是集合比较子句示例查找工资高于生物系所有教师的教师姓名的定义示例因为不小于因为不小于不等于且不等于重要等价关系但是测试空关系构造如果参数子查询非空则返回集合包含示例查找年秋季和年春季都开设的所有课程相关名外部查询中的变量相关子查询内部查询的使用示例查找选修了生物系开设的所有课程的学生思路生物系开设的所有课程某个特定学生选修的所有课程判断是否包含即测试重复元组测试检查子查询结果中是否有重复元组示例查找年最多开设一次的所有课程子句中的子查询示例查找平均工资超过美元的系的平均教师工资方法方法给派生关系命名子句推荐使用功能子句提供了一种定义临时关系的方法该关系仅在包含子句的查询中可用优点将复杂查询分解为若干步每个视图定义一个中间计算结果逻辑清晰示例查找所有预算最高的系示例查找总工资大于所有系平均总工资的系标量子查询定义标量子查询是期望返回单个值的子查询示例列出所有系及其教师数量十数据库修改删除操作基本语法示例删除所有教师示例删除财务系的所有教师示例删除楼中系的所有教师示例删除工资低于平均工资的教师执行顺序问题删除元组时平均工资会改变解决方案首先计算并找到所有要删除的元组然后删除所有找到的元组不重新计算平均值或重新测试元组插入操作基本语法示例添加新课程等价写法示例插入值示例从查询结果插入将音乐系中获得超过学分的每个学生聘为音乐系教师工资为美元重要特性语句在将其结果插入关系之前完全求值否则像下面的查询会导致问题更新操作基本语法示例给所有教师加薪示例条件更新给工资低于的教师加薪示例使用子查询给工资低于平均工资的教师加薪示例多条件更新的顺序问题工资超过的教师加薪其他加薪方案两个语句顺序很重要如果顺序相反初始工资为的教师会被加薪两次条件更新语句更好的解决方案使用标量子查询更新示例重新计算并更新所有学生的值问题对于没有选修任何课程的学生会被设置为改进方案多表更新示例给定利用的内容更新十一重要实践建议命名规范在等大型商用数据库系统中关系表的属性名只能取英文名不支持中文属性名支持中英文属性名开发大型数据库应用时程序访问的关系表属性名最好取英文名便于应用程序的可移植性准确表示英文专业术语性能优化建议避免使用实际应用中避免在子句中使用防止索引失效避免属性值实际应用中避免引入属性值防止索引失效用默认值替代控制子句的表数量子句包括多个关系表时要在子句中加入连接条件防止出现代价高昂的多表笛卡尔积操作频繁执行的查询子句的表个数不要过多不超过个表如需查询涉及张表考虑将数据进行合并避免低效的嵌套查询从优化角度避免使用低效的嵌套查询改为子句中的多表连接便于查询优化避免大数据排序不要用数据库的操作对大数据文件进行排序优先使用子句使用子句将复杂查询分解为多步逻辑清晰便于维护总结这份课件涵盖了的核心知识点数据定义创建修改删除表结构基本查询结构高级查询连接聚合分组排序集合操作嵌套查询等数据修改',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-12-23 23:23:24',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><style>
  /* === 只添加半透明磨砂效果，不改变任何布局 === */
  
  /* 1. 导航栏内所有可点击元素添加磨砂背景 */
  #nav a,
  #nav button {
    /* 保持原有布局，只添加背景效果 */
    backdrop-filter: blur(6px) !important;
    -webkit-backdrop-filter: blur(6px) !important;
    transition: backdrop-filter 0.3s ease !important;
  }
  
  /* 2. 浅色模式：白色半透明 */
  body:not([data-theme="dark"]) #nav a,
  body:not([data-theme="dark"]) #nav button {
    background-color: rgba(255, 255, 255, 0.1) !important;
  }
  
  /* 3. 深色模式：黑色半透明 */
  [data-theme="dark"] #nav a,
  [data-theme="dark"] #nav button {
    background-color: rgba(0, 0, 0, 0.1) !important;
  }
  
  /* 4. 悬停效果：稍微增加透明度 */
  #nav a:hover,
  #nav button:hover {
    backdrop-filter: blur(8px) !important;
    -webkit-backdrop-filter: blur(8px) !important;
  }
  
  body:not([data-theme="dark"]) #nav a:hover,
  body:not([data-theme="dark"]) #nav button:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
  }
  
  [data-theme="dark"] #nav a:hover,
  [data-theme="dark"] #nav button:hover {
    background-color: rgba(0, 0, 0, 0.15) !important;
  }
</style>
<link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 8.1.1"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://hexo.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Yuejin's Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI-Platform/" style="font-size: 1.05rem;">AI Platform<sup>1</sup></a><a href="/tags/Database/" style="font-size: 1.05rem;">Database<sup>2</sup></a><a href="/tags/English/" style="font-size: 1.05rem;">English<sup>1</sup></a><a href="/tags/RNN/" style="font-size: 1.05rem;">RNN<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 1.05rem;">SQL<sup>1</sup></a><a href="/tags/Self-Attention/" style="font-size: 1.05rem;">Self Attention<sup>1</sup></a><a href="/tags/plan/" style="font-size: 1.05rem;">plan<sup>2</sup></a><a href="/tags/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/" style="font-size: 1.05rem;">关系模型<sup>1</sup></a><a href="/tags/%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B/" style="font-size: 1.05rem;">自注意力<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">December 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Database/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Database</span></a><a class="article-meta__tags" href="/tags/SQL/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>SQL</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Intro-to-SQL 简读</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-12-22T06:53:42.900Z" title="发表于 2025-12-22 14:53:42">2025-12-22</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-12-23T15:23:24.974Z" title="更新于 2025-12-23 23:23:24">2025-12-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/db_cover.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/"><header><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a><a href="/tags/Database/" tabindex="-1" itemprop="url">Database</a><a href="/tags/SQL/" tabindex="-1" itemprop="url">SQL</a><h1 id="CrawlerTitle" itemprop="name headline">Intro-to-SQL 简读</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Yuejin Wu</span><time itemprop="dateCreated datePublished" datetime="2025-12-22T06:53:42.900Z" title="发表于 2025-12-22 14:53:42">2025-12-22</time><time itemprop="dateCreated datePublished" datetime="2025-12-23T15:23:24.974Z" title="更新于 2025-12-23 23:23:24">2025-12-23</time></header><h2 id="一、SQL概述（Overview-of-SQL）"><a href="#一、SQL概述（Overview-of-SQL）" class="headerlink" title="一、SQL概述（Overview of SQL）"></a>一、SQL概述（Overview of SQL）</h2><h3 id="1-1-SQL的基本概念"><a href="#1-1-SQL的基本概念" class="headerlink" title="1.1 SQL的基本概念"></a>1.1 SQL的基本概念</h3><p><strong>SQL (Structured Query Language)</strong> 是一种结构化查询语言，是使用最广泛的数据库查询语言。它已经扩展到其他领域，例如大数据（BigData）处理。</p>
<h3 id="1-2-SQL的组成部分"><a href="#1-2-SQL的组成部分" class="headerlink" title="1.2 SQL的组成部分"></a>1.2 SQL的组成部分</h3><p>SQL由以下几个主要部分组成：</p>
<p><strong>1. DML（数据操作语言 - Data Manipulation Language）</strong></p>
<ul>
<li>查询&#x2F;检索信息的能力</li>
<li>对元组进行选择、插入、删除、更新操作</li>
<li>主要命令：SELECT, INSERT, DELETE, UPDATE</li>
</ul>
<p><strong>2. DDL（数据定义语言 - Data Definition Language）</strong></p>
<ul>
<li>对模式、视图和索引进行定义、删除、修改</li>
<li>主要命令：CREATE, DROP, ALTER</li>
</ul>
<p><strong>3. 完整性约束（Integrity Constraints）</strong></p>
<ul>
<li>指定完整性约束的命令</li>
</ul>
<p><strong>4. 视图定义（View Definition）</strong></p>
<ul>
<li>定义视图的命令</li>
</ul>
<p><strong>5. 事务控制（Transaction Control）</strong></p>
<ul>
<li>指定事务开始和结束的命令</li>
<li>主要命令：BEGIN TRANSACTION, COMMIT, ROLLBACK</li>
</ul>
<p><strong>6. 嵌入式SQL和动态SQL</strong></p>
<ul>
<li>嵌入在编程语言中的SQL语句</li>
</ul>
<p><strong>7. 授权（Authorization）</strong></p>
<ul>
<li>主要命令：GRANT, REVOKE</li>
</ul>
<hr>
<h2 id="二、SQL数据定义（DDL）"><a href="#二、SQL数据定义（DDL）" class="headerlink" title="二、SQL数据定义（DDL）"></a>二、SQL数据定义（DDL）</h2><h3 id="2-1-DDL的功能"><a href="#2-1-DDL的功能" class="headerlink" title="2.1 DDL的功能"></a>2.1 DDL的功能</h3><p>DDL允许对关系进行以下规范：</p>
<ul>
<li>每个关系的模式（schema）</li>
<li>与每个属性关联的值类型</li>
<li>完整性约束（如 age&gt;0）</li>
<li>为每个关系维护的索引</li>
<li>每个关系的安全和授权信息</li>
<li>每个关系在磁盘上的物理存储结构</li>
</ul>
<h3 id="2-2-域类型（Domain-Types）"><a href="#2-2-域类型（Domain-Types）" class="headerlink" title="2.2 域类型（Domain Types）"></a>2.2 域类型（Domain Types）</h3><p><strong>基本数据类型：</strong></p>
<ol>
<li><p><strong>char(n)</strong> - 固定长度字符串，用户指定长度n</p>
</li>
<li><p><strong>varchar(n)</strong> - 可变长度字符串，用户指定最大长度n</p>
</li>
<li><p><strong>int</strong> - 整数（依赖于机器）</p>
</li>
<li><p><strong>smallint</strong> - 小整数（整数的机器依赖子集）</p>
</li>
<li><p>numeric(p,d)</p>
<p> - 定点数</p>
<ul>
<li>p：精度（总位数）</li>
<li>d：小数点右侧的位数</li>
<li>例如：numeric(3,1) 可以精确存储 44.5</li>
</ul>
</li>
</ol>
<p><strong>日期和时间类型：</strong></p>
<ol>
<li><strong>date</strong> - 日期，包含年（4位）、月、日<ul>
<li>例如：date ‘2001-07-27’</li>
</ul>
</li>
<li><strong>time</strong> - 时间，包含小时、分钟、秒<ul>
<li>例如：time ‘09:00:30’ 或 time ‘09:00:30.75’</li>
</ul>
</li>
<li><strong>timestamp</strong> - 日期加时间<ul>
<li>例如：timestamp ‘2001-7-27 09:00:30.75’</li>
</ul>
</li>
<li><strong>interval</strong> - 时间间隔<ul>
<li>两个日期&#x2F;时间&#x2F;时间戳相减得到间隔值</li>
<li>例如：interval ‘1’ day</li>
<li>间隔值可以加到日期&#x2F;时间&#x2F;时间戳值上</li>
</ul>
</li>
</ol>
<p><strong>空值处理：</strong></p>
<ul>
<li>所有域类型都允许空值（NULL）</li>
<li>声明属性为 NOT NULL 可以禁止该属性为空值</li>
</ul>
<p><strong>用户自定义类型：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> domain person<span class="operator">-</span>name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not null</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-创建表（Create-Table）"><a href="#2-3-创建表（Create-Table）" class="headerlink" title="2.3 创建表（Create Table）"></a>2.3 创建表（Create Table）</h3><p><strong>基本语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> r (</span><br><span class="line">    A1 D1,</span><br><span class="line">    A2 D2,</span><br><span class="line">    ...,</span><br><span class="line">    An Dn,</span><br><span class="line">    (integrity<span class="operator">-</span>constraint1),</span><br><span class="line">    ...,</span><br><span class="line">    (integrity<span class="operator">-</span>constraintk)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>r 是关系名称</li>
<li>Ai 是属性名</li>
<li>Di 是属性Ai的数据类型</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> instructor (</span><br><span class="line">    ID <span class="type">char</span>(<span class="number">5</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    salary <span class="type">numeric</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="2-4-完整性约束（Integrity-Constraints）"><a href="#2-4-完整性约束（Integrity-Constraints）" class="headerlink" title="2.4 完整性约束（Integrity Constraints）"></a>2.4 完整性约束（Integrity Constraints）</h3><p><strong>主要约束类型：</strong></p>
<ol>
<li><strong>primary key (A1, …, An)</strong> - 主键约束</li>
<li><strong>foreign key (Am, …, An) references r</strong> - 外键约束</li>
<li><strong>not null</strong> - 非空约束</li>
</ol>
<p><strong>完整示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> instructor (</span><br><span class="line">    ID <span class="type">char</span>(<span class="number">5</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not null</span>,</span><br><span class="line">    dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    salary <span class="type">numeric</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">primary key</span> (ID),</span><br><span class="line">    <span class="keyword">foreign key</span> (dept_name) <span class="keyword">references</span> department</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>复合主键示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> takes (</span><br><span class="line">    ID <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">    course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line">    grade <span class="type">varchar</span>(<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">primary key</span> (ID, course_id, <span class="keyword">year</span>),</span><br><span class="line">    <span class="keyword">foreign key</span> (ID) <span class="keyword">references</span> student,</span><br><span class="line">    <span class="keyword">foreign key</span> (course_id, <span class="keyword">year</span>) <span class="keyword">references</span> section</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-5-模式更新（Schema-Updates）"><a href="#2-5-模式更新（Schema-Updates）" class="headerlink" title="2.5 模式更新（Schema Updates）"></a>2.5 模式更新（Schema Updates）</h3><p><strong>删除表：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> r</span><br></pre></td></tr></table></figure>

<p><strong>添加属性：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> r <span class="keyword">add</span> A D</span><br></pre></td></tr></table></figure>

<ul>
<li>A 是要添加的属性名</li>
<li>D 是属性的域</li>
<li>所有现有元组的新属性值被赋为 NULL</li>
<li>例如：<code>alter table student add age integer</code></li>
</ul>
<p><strong>删除属性：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> r <span class="keyword">drop</span> A</span><br></pre></td></tr></table></figure>

<ul>
<li>A 是要删除的属性名</li>
<li>例如：<code>alter table student drop age</code></li>
<li>注意：许多数据库不支持删除属性</li>
</ul>
<p><strong>性能考虑：</strong></p>
<ul>
<li>表中的元组按行存储</li>
<li>添加属性或删除表会导致昂贵的记录修改和移动操作</li>
<li>NoSQL数据库和大数据系统采用列式存储以优化此类操作</li>
</ul>
<hr>
<h2 id="三、SQL查询基本结构"><a href="#三、SQL查询基本结构" class="headerlink" title="三、SQL查询基本结构"></a>三、SQL查询基本结构</h2><h3 id="3-1-基本查询形式"><a href="#3-1-基本查询形式" class="headerlink" title="3.1 基本查询形式"></a>3.1 基本查询形式</h3><p><strong>标准SQL查询结构：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> A1, A2, ..., An</span><br><span class="line"><span class="keyword">from</span> r1, r2, ..., rm</span><br><span class="line"><span class="keyword">where</span> P</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>Ai 表示属性</li>
<li>ri 表示关系</li>
<li>P 是谓词（条件）</li>
<li>查询结果是一个关系</li>
</ul>
<p><strong>等价的关系代数表达式：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">πA1, A2, ..., An(σP(r1 × r2 × ... × rm))</span><br></pre></td></tr></table></figure>

<h3 id="3-2-SELECT子句详解"><a href="#3-2-SELECT子句详解" class="headerlink" title="3.2 SELECT子句详解"></a>3.2 SELECT子句详解</h3><p><strong>基本功能：</strong></p>
<ul>
<li>SELECT子句列出属性，对应关系代数的投影操作</li>
</ul>
<p><strong>示例1：查询所有教师姓名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br></pre></td></tr></table></figure>

<p><strong>大小写不敏感：</strong></p>
<ul>
<li>Name ≡ NAME ≡ name</li>
</ul>
<p><strong>去除重复（DISTINCT）：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> dept_name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br></pre></td></tr></table></figure>

<p><strong>保留重复（ALL）：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">all</span> dept_name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br></pre></td></tr></table></figure>

<ul>
<li>ALL是默认选项</li>
</ul>
<p><strong>使用星号（*）选择所有属性：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> instructor</span><br></pre></td></tr></table></figure>

<p>⚠️ <strong>实际应用中应避免使用*，可能导致索引失效</strong></p>
<p><strong>字面量（Literal）：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 无FROM子句</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;437&#x27;</span>  <span class="comment">-- 结果：单列单行，值为437</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;437&#x27;</span> <span class="keyword">as</span> FOO  <span class="comment">-- 给列命名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有FROM子句</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line"><span class="keyword">from</span> instructor  <span class="comment">-- 结果：N行（instructor表的行数），每行值为&#x27;A&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>算术表达式：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ID, name, salary<span class="operator">/</span><span class="number">12</span></span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用AS重命名</span></span><br><span class="line"><span class="keyword">select</span> ID, name, salary<span class="operator">/</span><span class="number">12</span> <span class="keyword">as</span> monthly_salary</span><br><span class="line"><span class="keyword">from</span> instructor</span><br></pre></td></tr></table></figure>

<h3 id="3-3-WHERE子句详解"><a href="#3-3-WHERE子句详解" class="headerlink" title="3.3 WHERE子句详解"></a>3.3 WHERE子句详解</h3><p><strong>基本功能：</strong></p>
<ul>
<li>WHERE子句指定结果必须满足的条件</li>
<li>对应关系代数的选择谓词</li>
</ul>
<p><strong>逻辑连接词：</strong></p>
<ul>
<li>AND（与）</li>
<li>OR（或）</li>
<li>NOT（非）</li>
</ul>
<p><strong>比较运算符：</strong></p>
<ul>
<li>&lt;, &lt;&#x3D;, &gt;, &gt;&#x3D;, &#x3D;, &lt;&gt;（不等于）</li>
</ul>
<p><strong>示例1：单条件查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Comp. Sci.&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>示例2：复合条件查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Comp. Sci.&#x27;</span> <span class="keyword">and</span> salary <span class="operator">&gt;</span> <span class="number">70000</span></span><br></pre></td></tr></table></figure>

<p><strong>BETWEEN运算符：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找工资在90000到100000之间的教师</span></span><br><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> salary <span class="keyword">between</span> <span class="number">90000</span> <span class="keyword">and</span> <span class="number">100000</span></span><br><span class="line"><span class="comment">-- 等价于：salary &gt;= 90000 and salary &lt;= 100000</span></span><br></pre></td></tr></table></figure>

<p><strong>元组比较运算符：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name, course_id</span><br><span class="line"><span class="keyword">from</span> instructor, teaches</span><br><span class="line"><span class="keyword">where</span> (instructor.ID, dept_name) <span class="operator">=</span> (teaches.ID, <span class="string">&#x27;Biology&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-4-FROM子句详解"><a href="#3-4-FROM子句详解" class="headerlink" title="3.4 FROM子句详解"></a>3.4 FROM子句详解</h3><p><strong>基本功能：</strong></p>
<ul>
<li>FROM子句列出关系</li>
<li>对应关系代数的笛卡尔积操作</li>
</ul>
<p><strong>笛卡尔积：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> instructor, teaches</span><br></pre></td></tr></table></figure>

<ul>
<li>生成每个instructor-teaches配对</li>
<li>包含两个关系的所有属性</li>
<li>对于共同属性（如ID），在结果表中使用关系名重命名（instructor.ID）</li>
</ul>
<p>⚠️ <strong>重要注意事项：</strong> 当FROM子句包含多个关系时：</p>
<ul>
<li><strong>必须在WHERE子句中加入连接条件</strong></li>
<li>防止产生代价高昂的多表笛卡尔积操作</li>
<li>频繁执行的SQL查询，FROM子句的表个数不要过多（<strong>不超过4个表</strong>）</li>
<li>如需查询涉及≥4张表，考虑将这些表的数据进行合并</li>
</ul>
<p><strong>连接查询示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找所有教过课的教师姓名和课程ID</span></span><br><span class="line"><span class="keyword">select</span> name, course_id</span><br><span class="line"><span class="keyword">from</span> instructor, teaches</span><br><span class="line"><span class="keyword">where</span> instructor.ID <span class="operator">=</span> teaches.ID</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加部门筛选</span></span><br><span class="line"><span class="keyword">select</span> name, course_id</span><br><span class="line"><span class="keyword">from</span> instructor, teaches</span><br><span class="line"><span class="keyword">where</span> instructor.ID <span class="operator">=</span> teaches.ID</span><br><span class="line">    <span class="keyword">and</span> instructor.dept_name <span class="operator">=</span> <span class="string">&#x27;Art&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-自然连接（Natural-Join）"><a href="#3-5-自然连接（Natural-Join）" class="headerlink" title="3.5 自然连接（Natural Join）"></a>3.5 自然连接（Natural Join）</h3><p><strong>语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name, course_id</span><br><span class="line"><span class="keyword">from</span> instructor <span class="keyword">natural</span> <span class="keyword">join</span> teaches</span><br><span class="line"><span class="keyword">where</span> instructor.dept_name <span class="operator">=</span> <span class="string">&#x27;Art&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>对比传统连接：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name, course_id</span><br><span class="line"><span class="keyword">from</span> instructor, teaches</span><br><span class="line"><span class="keyword">where</span> instructor.ID <span class="operator">=</span> teaches.ID</span><br><span class="line">    <span class="keyword">and</span> instructor.dept_name <span class="operator">=</span> <span class="string">&#x27;Art&#x27;</span></span><br></pre></td></tr></table></figure>

<p>自然连接自动匹配两个关系中所有同名属性。</p>
<hr>
<h2 id="四、SQL查询的计算过程"><a href="#四、SQL查询的计算过程" class="headerlink" title="四、SQL查询的计算过程"></a>四、SQL查询的计算过程</h2><h3 id="4-1-完整的SELECT语法"><a href="#4-1-完整的SELECT语法" class="headerlink" title="4.1 完整的SELECT语法"></a>4.1 完整的SELECT语法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;<span class="keyword">ALL</span> <span class="operator">|</span> <span class="keyword">DISTINCT</span>&#125; &#123;<span class="operator">&lt;</span><span class="keyword">column</span> expression<span class="operator">&gt;</span>&#125;</span><br><span class="line"><span class="keyword">from</span> &#123;<span class="operator">&lt;</span>table_name <span class="keyword">or</span> view_name<span class="operator">&gt;</span>&#125;</span><br><span class="line">[<span class="keyword">where</span> <span class="operator">&lt;</span>conditional expression <span class="number">1</span><span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">group</span> <span class="keyword">by</span> <span class="operator">&lt;</span>column_name <span class="number">1</span><span class="operator">&gt;</span></span><br><span class="line">    [<span class="keyword">having</span> <span class="operator">&lt;</span>conditional expression <span class="number">2</span><span class="operator">&gt;</span>]]</span><br><span class="line">[<span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>column_name <span class="number">2</span><span class="operator">&gt;</span> &#123;<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="4-2-查询执行顺序"><a href="#4-2-查询执行顺序" class="headerlink" title="4.2 查询执行顺序"></a>4.2 查询执行顺序</h3><p><strong>1. FROM和WHERE阶段：</strong></p>
<ul>
<li>从FROM子句列出的基表或视图中选择满足WHERE条件的元组</li>
<li>从这些元组中选择属性，形成结果表</li>
</ul>
<p><strong>2. GROUP BY和聚合函数阶段：</strong></p>
<ul>
<li>根据条件表达式对结果表进行分组</li>
<li>对每个组执行组&#x2F;聚合函数</li>
<li>输出每个组作为结果</li>
</ul>
<p><strong>3. HAVING阶段：</strong></p>
<ul>
<li>对分组结果进行筛选</li>
<li>输出满足条件的组</li>
</ul>
<p><strong>4. ORDER BY阶段：</strong></p>
<ul>
<li>对结果表或组按降序或升序排序</li>
</ul>
<hr>
<h2 id="五、其他基本操作"><a href="#五、其他基本操作" class="headerlink" title="五、其他基本操作"></a>五、其他基本操作</h2><h3 id="5-1-重命名操作（RENAME）"><a href="#5-1-重命名操作（RENAME）" class="headerlink" title="5.1 重命名操作（RENAME）"></a>5.1 重命名操作（RENAME）</h3><p><strong>使用AS子句重命名关系和属性：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">old</span><span class="operator">-</span>name <span class="keyword">as</span> <span class="keyword">new</span><span class="operator">-</span>name</span><br></pre></td></tr></table></figure>

<p><strong>示例：找出所有工资高于计算机科学系教师的教师姓名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> T.name <span class="keyword">as</span> TeacherName</span><br><span class="line"><span class="keyword">from</span> instructor <span class="keyword">as</span> T, instructor <span class="keyword">as</span> S</span><br><span class="line"><span class="keyword">where</span> T.salary <span class="operator">&gt;</span> S.salary </span><br><span class="line">    <span class="keyword">and</span> S.dept_name <span class="operator">=</span> <span class="string">&#x27;Comp. Sci.&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用元组变量（tuple variable）T和S区分同一关系的不同实例</li>
<li>AS关键字是可选的：<code>instructor as T ≡ instructor T</code></li>
</ul>
<p><strong>为什么需要元组变量？</strong></p>
<ul>
<li>涉及对instructor关系中salary属性的不同值的比较</li>
<li>利用T和S区分不同的instructor实例</li>
<li>实现了对同一属性的不同值的比较</li>
</ul>
<h3 id="5-2-字符串操作"><a href="#5-2-字符串操作" class="headerlink" title="5.2 字符串操作"></a>5.2 字符串操作</h3><p><strong>模式匹配运算符LIKE：</strong></p>
<p><strong>特殊字符：</strong></p>
<ol>
<li><strong>百分号（%）</strong> - 匹配任意子串</li>
<li><strong>下划线（_）</strong> - 匹配任意单个字符</li>
</ol>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找姓名中包含&quot;dar&quot;的所有教师</span></span><br><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%dar%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 匹配字符串&quot;100%&quot;</span></span><br><span class="line"><span class="keyword">like</span> <span class="string">&#x27;100\%&#x27;</span> <span class="keyword">escape</span> <span class="string">&#x27;\&#x27;</span></span><br><span class="line"><span class="comment">-- 使用反斜杠作为转义字符</span></span><br></pre></td></tr></table></figure>

<p><strong>模式示例：</strong></p>
<ul>
<li><code>&#39;Intro%&#39;</code> - 匹配以”Intro”开头的任意字符串</li>
<li><code>&#39;%Comp%&#39;</code> - 匹配包含”Comp”作为子串的任意字符串</li>
<li><code>&#39;___&#39;</code> - 匹配恰好三个字符的字符串</li>
<li><code>&#39;___%&#39;</code> - 匹配至少三个字符的字符串</li>
</ul>
<p><strong>注意：模式是大小写敏感的</strong></p>
<p><strong>其他字符串操作：</strong></p>
<ul>
<li>连接（使用”||”）</li>
<li>大小写转换</li>
<li>查找字符串长度</li>
<li>提取子串等</li>
</ul>
<h3 id="5-3-结果排序（ORDER-BY）"><a href="#5-3-结果排序（ORDER-BY）" class="headerlink" title="5.3 结果排序（ORDER BY）"></a>5.3 结果排序（ORDER BY）</h3><p><strong>基本排序：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按字母顺序列出所有教师姓名</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> name</span><br></pre></td></tr></table></figure>

<p><strong>指定排序方向：</strong></p>
<ul>
<li><strong>DESC</strong> - 降序</li>
<li><strong>ASC</strong> - 升序（默认）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> name <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<p><strong>多属性排序：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> dept_name, name</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不同属性不同排序方向</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> dept_name <span class="keyword">asc</span>, name <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<p>⚠️ <strong>性能警告：</strong> 避免使用数据库的ORDER BY操作对大数据文件进行排序，这可能导致严重的性能问题。</p>
<hr>
<h2 id="六、集合操作（Set-Operations）"><a href="#六、集合操作（Set-Operations）" class="headerlink" title="六、集合操作（Set Operations）"></a>六、集合操作（Set Operations）</h2><h3 id="6-1-基本集合操作"><a href="#6-1-基本集合操作" class="headerlink" title="6.1 基本集合操作"></a>6.1 基本集合操作</h3><p>SQL支持三种集合操作：</p>
<ul>
<li><strong>UNION</strong> - 并集（∪）</li>
<li><strong>INTERSECT</strong> - 交集（∩）</li>
<li><strong>EXCEPT</strong> - 差集（−）</li>
</ul>
<p><strong>特点：</strong></p>
<ul>
<li>自动消除重复</li>
<li>要保留重复，使用：UNION ALL, INTERSECT ALL, EXCEPT ALL</li>
</ul>
<h3 id="6-2-UNION（并集）"><a href="#6-2-UNION（并集）" class="headerlink" title="6.2 UNION（并集）"></a>6.2 UNION（并集）</h3><p><strong>示例：查找2017年秋季或2018年春季开设的课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> course_id </span><br><span class="line"> <span class="keyword">from</span> section </span><br><span class="line"> <span class="keyword">where</span> sem <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span>)</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line">(<span class="keyword">select</span> course_id </span><br><span class="line"> <span class="keyword">from</span> section </span><br><span class="line"> <span class="keyword">where</span> sem <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-3-INTERSECT（交集）"><a href="#6-3-INTERSECT（交集）" class="headerlink" title="6.3 INTERSECT（交集）"></a>6.3 INTERSECT（交集）</h3><p><strong>示例：查找既在2017年秋季又在2018年春季开设的课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> course_id </span><br><span class="line"> <span class="keyword">from</span> section </span><br><span class="line"> <span class="keyword">where</span> sem <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span>)</span><br><span class="line"><span class="keyword">intersect</span></span><br><span class="line">(<span class="keyword">select</span> course_id </span><br><span class="line"> <span class="keyword">from</span> section </span><br><span class="line"> <span class="keyword">where</span> sem <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-4-EXCEPT（差集）"><a href="#6-4-EXCEPT（差集）" class="headerlink" title="6.4 EXCEPT（差集）"></a>6.4 EXCEPT（差集）</h3><p><strong>示例：查找2017年秋季开设但2018年春季没有开设的课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> course_id </span><br><span class="line"> <span class="keyword">from</span> section </span><br><span class="line"> <span class="keyword">where</span> sem <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span>)</span><br><span class="line"><span class="keyword">except</span></span><br><span class="line">(<span class="keyword">select</span> course_id </span><br><span class="line"> <span class="keyword">from</span> section </span><br><span class="line"> <span class="keyword">where</span> sem <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、空值处理（NULL-Values）"><a href="#七、空值处理（NULL-Values）" class="headerlink" title="七、空值处理（NULL Values）"></a>七、空值处理（NULL Values）</h2><h3 id="7-1-NULL的含义"><a href="#7-1-NULL的含义" class="headerlink" title="7.1 NULL的含义"></a>7.1 NULL的含义</h3><p>NULL表示：</p>
<ul>
<li>未知值（unknown value）</li>
<li>值不存在（value does not exist）</li>
</ul>
<h3 id="7-2-算术运算与NULL"><a href="#7-2-算术运算与NULL" class="headerlink" title="7.2 算术运算与NULL"></a>7.2 算术运算与NULL</h3><p>任何涉及NULL的算术表达式结果都是NULL</p>
<ul>
<li>例如：5 + null &#x3D; null</li>
</ul>
<h3 id="7-3-检查NULL值"><a href="#7-3-检查NULL值" class="headerlink" title="7.3 检查NULL值"></a>7.3 检查NULL值</h3><p>使用 <strong>IS NULL</strong> 谓词：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找工资为NULL的所有教师</span></span><br><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> salary <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-比较运算与NULL"><a href="#7-4-比较运算与NULL" class="headerlink" title="7.4 比较运算与NULL"></a>7.4 比较运算与NULL</h3><p>SQL将涉及NULL的任何比较结果视为<strong>未知（unknown）</strong></p>
<ul>
<li>5 &lt; null → unknown</li>
<li>null &lt;&gt; null → unknown</li>
<li>null &#x3D; null → unknown</li>
</ul>
<h3 id="7-5-布尔运算与UNKNOWN"><a href="#7-5-布尔运算与UNKNOWN" class="headerlink" title="7.5 布尔运算与UNKNOWN"></a>7.5 布尔运算与UNKNOWN</h3><p><strong>AND运算：</strong></p>
<ul>
<li>true AND unknown &#x3D; unknown</li>
<li>false AND unknown &#x3D; false</li>
<li>unknown AND unknown &#x3D; unknown</li>
</ul>
<p><strong>OR运算：</strong></p>
<ul>
<li>unknown OR true &#x3D; true</li>
<li>unknown OR false &#x3D; unknown</li>
<li>unknown OR unknown &#x3D; unknown</li>
</ul>
<p><strong>WHERE子句处理：</strong></p>
<ul>
<li>如果WHERE子句的谓词求值为unknown，则视为false</li>
</ul>
<p>⚠️ <strong>实际应用建议：</strong> 避免引入属性NULL值，防止索引失效；使用默认值（default value）替代。</p>
<hr>
<h2 id="八、聚合函数（Aggregate-Functions）"><a href="#八、聚合函数（Aggregate-Functions）" class="headerlink" title="八、聚合函数（Aggregate Functions）"></a>八、聚合函数（Aggregate Functions）</h2><h3 id="8-1-基本聚合函数"><a href="#8-1-基本聚合函数" class="headerlink" title="8.1 基本聚合函数"></a>8.1 基本聚合函数</h3><p>聚合函数对列的值进行操作，但返回单个值：</p>
<ol>
<li><strong>avg</strong> - 平均值</li>
<li><strong>min</strong> - 最小值</li>
<li><strong>max</strong> - 最大值</li>
<li><strong>sum</strong> - 求和</li>
<li><strong>count</strong> - 计数</li>
</ol>
<h3 id="8-2-聚合函数语法"><a href="#8-2-聚合函数语法" class="headerlink" title="8.2 聚合函数语法"></a>8.2 聚合函数语法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;A1, A2, ..., Ai&#125;, ag_fun(Ai<span class="operator">+</span><span class="number">1</span>), ..., ag_fun(Ai<span class="operator">+</span>k)</span><br><span class="line"><span class="keyword">from</span> r1, r2, ..., rm</span><br><span class="line"><span class="keyword">where</span> P1</span><br><span class="line">[<span class="keyword">group</span> <span class="keyword">by</span> A1, A2, ..., Ai</span><br><span class="line">    [<span class="keyword">having</span> P2]]</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>P1 定义在 r1, r2, …, rm 的所有属性上</li>
<li>P2 定义在 A1, A2, …, Ai 上，作为GROUP BY的约束</li>
</ul>
<h3 id="8-3-基本聚合示例"><a href="#8-3-基本聚合示例" class="headerlink" title="8.3 基本聚合示例"></a>8.3 基本聚合示例</h3><p><strong>示例1：计算平均工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(salary)</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Comp. Sci.&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>示例2：计算教师数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> ID)</span><br><span class="line"><span class="keyword">from</span> teaches</span><br><span class="line"><span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span></span><br></pre></td></tr></table></figure>

<p><strong>示例3：计算元组数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> course</span><br></pre></td></tr></table></figure>

<h3 id="8-4-GROUP-BY子句"><a href="#8-4-GROUP-BY子句" class="headerlink" title="8.4 GROUP BY子句"></a>8.4 GROUP BY子句</h3><p><strong>功能：</strong> 将结果按指定属性分组</p>
<p><strong>示例：查找每个系的平均工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">as</span> avg_salary</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br></pre></td></tr></table></figure>

<p><strong>重要规则：</strong> SELECT子句中在聚合函数外的属性必须出现在GROUP BY列表中</p>
<p><strong>错误示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 错误！ID不在GROUP BY中</span></span><br><span class="line"><span class="keyword">select</span> dept_name, ID, <span class="built_in">avg</span>(salary)</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br></pre></td></tr></table></figure>

<p><strong>NULL值处理：</strong> 除了count(*)外，所有聚合操作都忽略聚合属性上的NULL值元组</p>
<h3 id="8-5-HAVING子句"><a href="#8-5-HAVING子句" class="headerlink" title="8.5 HAVING子句"></a>8.5 HAVING子句</h3><p><strong>功能：</strong> 对分组形成后的结果应用条件</p>
<p><strong>示例：查找平均工资超过42000的所有系的名称和平均工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">as</span> avg_salary</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(salary) <span class="operator">&gt;</span> <span class="number">42000</span></span><br></pre></td></tr></table></figure>

<p><strong>WHERE vs HAVING：</strong></p>
<ul>
<li><strong>WHERE</strong> - 在形成分组<strong>之前</strong>应用谓词</li>
<li><strong>HAVING</strong> - 在形成分组<strong>之后</strong>应用谓词</li>
</ul>
<hr>
<h2 id="九、嵌套子查询（Nested-Subqueries）"><a href="#九、嵌套子查询（Nested-Subqueries）" class="headerlink" title="九、嵌套子查询（Nested Subqueries）"></a>九、嵌套子查询（Nested Subqueries）</h2><h3 id="9-1-基本概念"><a href="#9-1-基本概念" class="headerlink" title="9.1 基本概念"></a>9.1 基本概念</h3><p>子查询是嵌套在另一个查询中的SELECT-FROM-WHERE表达式。</p>
<p><strong>可以出现的位置：</strong></p>
<ol>
<li><strong>FROM子句：</strong> ri可以被任何有效的子查询替换</li>
<li><strong>WHERE子句：</strong> P可以被表达式替换：<code>B &lt;operation&gt; (subquery)</code></li>
<li><strong>SELECT子句：</strong> Ai可以被生成单个值的子查询替换</li>
</ol>
<p>⚠️ <strong>优化建议：</strong> 从SQL优化角度，避免使用低效的嵌套查询，改为FROM子句中的多表连接，便于DBMS查询优化。</p>
<h3 id="9-2-集合成员资格（Set-Membership）"><a href="#9-2-集合成员资格（Set-Membership）" class="headerlink" title="9.2 集合成员资格（Set Membership）"></a>9.2 集合成员资格（Set Membership）</h3><p><strong>IN运算符：</strong></p>
<p><strong>示例1：查找2009年秋季和2010年春季都开设的课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> course_id</span><br><span class="line"><span class="keyword">from</span> section</span><br><span class="line"><span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">    <span class="keyword">and</span> course_id <span class="keyword">in</span> (</span><br><span class="line">        <span class="keyword">select</span> course_id</span><br><span class="line">        <span class="keyword">from</span> section</span><br><span class="line">        <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><strong>NOT IN运算符：</strong></p>
<p><strong>示例2：查找2009年秋季开设但2010年春季未开设的课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> course_id</span><br><span class="line"><span class="keyword">from</span> section</span><br><span class="line"><span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">    <span class="keyword">and</span> course_id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">        <span class="keyword">select</span> course_id</span><br><span class="line">        <span class="keyword">from</span> section</span><br><span class="line">        <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><strong>执行过程：</strong></p>
<ol>
<li>从头至尾依次扫描section中每一行</li>
<li>对每一行：<ul>
<li>判断其semester、year是否满足查询条件</li>
<li>执行嵌入在WHERE子句中的SELECT查询</li>
<li>判断本行的course_id是否在结果集合中</li>
</ul>
</li>
</ol>
<p>⚠️ <strong>性能问题：</strong></p>
<ul>
<li>嵌入式查询可能执行效率较低</li>
<li>被嵌入的SELECT子句可能多次重复执行</li>
<li>实际应用中应尽量避免membership等嵌入式查询</li>
</ul>
<p><strong>改进方案（多表连接）：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 低效的嵌套查询</span></span><br><span class="line"><span class="keyword">select</span> SECTOR_ID, PHYCELLID</span><br><span class="line"><span class="keyword">from</span> tbPCIAssignment</span><br><span class="line"><span class="keyword">where</span> EARFCN<span class="operator">=</span><span class="string">&#x27;38400&#x27;</span> <span class="keyword">and</span> ASSIGN_ID<span class="operator">=</span><span class="number">0</span></span><br><span class="line">    <span class="keyword">and</span> SECTOR_ID <span class="keyword">in</span> (</span><br><span class="line">        <span class="keyword">select</span> N_SECTOR_ID</span><br><span class="line">        <span class="keyword">from</span> tbAdjCell</span><br><span class="line">        <span class="keyword">where</span> S_SECTOR_ID<span class="operator">=</span><span class="string">&#x27;58617-1&#x27;</span> <span class="keyword">and</span> N_EARFCN<span class="operator">=</span><span class="string">&#x27;38400&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 高效的多表连接</span></span><br><span class="line"><span class="keyword">select</span> A.SECTOR_ID, A.PHYCELLID</span><br><span class="line"><span class="keyword">from</span> tbPCIAssignment <span class="keyword">as</span> A, tbAdjCell <span class="keyword">as</span> B</span><br><span class="line"><span class="keyword">where</span> A.EARFCN<span class="operator">=</span><span class="string">&#x27;38400&#x27;</span> </span><br><span class="line">    <span class="keyword">and</span> A.ASSIGN_ID<span class="operator">=</span><span class="number">0</span></span><br><span class="line">    <span class="keyword">and</span> A.SECTOR_ID<span class="operator">=</span>B.N_SECTOR_ID</span><br><span class="line">    <span class="keyword">and</span> B.S_SECTOR_ID<span class="operator">=</span><span class="string">&#x27;58617-1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>根据课件中的SQL Server执行计划，性能比为 <strong>77:23</strong>（嵌套查询更慢）</p>
<p><strong>其他IN用法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 名字不是&quot;Mozart&quot;也不是&quot;Einstein&quot;的教师</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;Mozart&#x27;</span>, <span class="string">&#x27;Einstein&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 元组IN</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> ID)</span><br><span class="line"><span class="keyword">from</span> takes</span><br><span class="line"><span class="keyword">where</span> (course_id, semester, <span class="keyword">year</span>) <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> course_id, semester, <span class="keyword">year</span></span><br><span class="line">    <span class="keyword">from</span> teaches</span><br><span class="line">    <span class="keyword">where</span> teaches.ID <span class="operator">=</span> <span class="number">10101</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="9-3-集合比较-SOME子句"><a href="#9-3-集合比较-SOME子句" class="headerlink" title="9.3 集合比较 - SOME子句"></a>9.3 集合比较 - SOME子句</h3><p><strong>示例：查找工资高于生物系至少一名教师的教师姓名</strong></p>
<p><strong>方法1：使用元组变量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> T.name</span><br><span class="line"><span class="keyword">from</span> instructor <span class="keyword">as</span> T, instructor <span class="keyword">as</span> S</span><br><span class="line"><span class="keyword">where</span> T.salary <span class="operator">&gt;</span> S.salary </span><br><span class="line">    <span class="keyword">and</span> S.dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>方法2：使用SOME</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">some</span> (</span><br><span class="line">    <span class="keyword">select</span> salary</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>SOME的定义：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F &lt;comp&gt; some r ⟺ ∃t ∈ r such that (F &lt;comp&gt; t)</span><br></pre></td></tr></table></figure>

<p>其中 <code>&lt;comp&gt;</code> 可以是：&lt;, &lt;&#x3D;, &gt;, &gt;&#x3D;, &#x3D;, &lt;&gt;</p>
<p><strong>示例：</strong></p>
<ul>
<li><code>(5 &lt; some {0, 5, 6})</code> &#x3D; true（因为5 &lt; 6）</li>
<li><code>(5 &lt; some {0, 5})</code> &#x3D; false</li>
<li><code>(5 = some {0, 5})</code> &#x3D; true（因为5 &#x3D; 5）</li>
<li><code>(5 ≠ some {0, 5})</code> &#x3D; true（因为5 ≠ 0）</li>
</ul>
<p><strong>重要等价关系：</strong></p>
<ul>
<li><code>(= some)</code> ≡ <code>in</code></li>
<li>但是 <code>(&lt;&gt; some)</code> ≠ <code>not in</code></li>
</ul>
<h3 id="9-4-集合比较-ALL子句"><a href="#9-4-集合比较-ALL子句" class="headerlink" title="9.4 集合比较 - ALL子句"></a>9.4 集合比较 - ALL子句</h3><p><strong>示例：查找工资高于生物系所有教师的教师姓名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">all</span> (</span><br><span class="line">    <span class="keyword">select</span> salary</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>ALL的定义：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F &lt;comp&gt; all r ⟺ ∀t ∈ r (F &lt;comp&gt; t)</span><br></pre></td></tr></table></figure>

<p><strong>示例：</strong></p>
<ul>
<li><code>(5 &lt; all {0, 5, 6})</code> &#x3D; false（因为5不小于5）</li>
<li><code>(5 &lt; all {6, 10, 4})</code> &#x3D; false（因为5不小于4）</li>
<li><code>(5 = all {4, 5})</code> &#x3D; false</li>
<li><code>(5 ≠ all {4, 6})</code> &#x3D; true（5不等于4且5不等于6）</li>
</ul>
<p><strong>重要等价关系：</strong></p>
<ul>
<li><code>(&lt;&gt; all)</code> ≡ <code>not in</code></li>
<li>但是 <code>(= all)</code> ≠ <code>in</code></li>
</ul>
<h3 id="9-5-测试空关系-EXISTS"><a href="#9-5-测试空关系-EXISTS" class="headerlink" title="9.5 测试空关系 - EXISTS"></a>9.5 测试空关系 - EXISTS</h3><p><strong>EXISTS构造：</strong> 如果参数子查询非空，则返回true</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exists r ⟺ r ≠ ∅</span><br><span class="line">not exists r ⟺ r = ∅</span><br></pre></td></tr></table></figure>

<p><strong>集合包含：</strong></p>
<ul>
<li>X − Y &#x3D; ∅ ⟺ X ⊆ Y</li>
<li>X ⊆ Y ⟺ (X − Y) &#x3D; ∅ ⟺ not exists (X except Y)</li>
</ul>
<p><strong>示例1：查找2017年秋季和2018年春季都开设的所有课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> course_id</span><br><span class="line"><span class="keyword">from</span> section <span class="keyword">as</span> S</span><br><span class="line"><span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span></span><br><span class="line">    <span class="keyword">and</span> <span class="keyword">exists</span> (</span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">        <span class="keyword">from</span> section <span class="keyword">as</span> T</span><br><span class="line">        <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span></span><br><span class="line">            <span class="keyword">and</span> S.course_id <span class="operator">=</span> T.course_id</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>相关名（Correlation name）</strong> - 外部查询中的变量S</li>
<li><strong>相关子查询（Correlated subquery）</strong> - 内部查询</li>
</ul>
<h3 id="9-6-NOT-EXISTS的使用"><a href="#9-6-NOT-EXISTS的使用" class="headerlink" title="9.6 NOT EXISTS的使用"></a>9.6 NOT EXISTS的使用</h3><p><strong>示例：查找选修了生物系开设的所有课程的学生</strong></p>
<p><strong>思路：</strong></p>
<ul>
<li>X &#x3D; 生物系开设的所有课程</li>
<li>Y &#x3D; 某个特定学生选修的所有课程</li>
<li>判断Y是否包含X（即 X ⊆ Y）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> S.ID, S.name</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">as</span> S</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">    (<span class="keyword">select</span> course_id</span><br><span class="line">     <span class="keyword">from</span> course</span><br><span class="line">     <span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span></span><br><span class="line">    (<span class="keyword">select</span> T.course_id</span><br><span class="line">     <span class="keyword">from</span> takes <span class="keyword">as</span> T</span><br><span class="line">     <span class="keyword">where</span> S.ID <span class="operator">=</span> T.ID)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="9-7-测试重复元组-UNIQUE"><a href="#9-7-测试重复元组-UNIQUE" class="headerlink" title="9.7 测试重复元组 - UNIQUE"></a>9.7 测试重复元组 - UNIQUE</h3><p><strong>UNIQUE测试：</strong> 检查子查询结果中是否有重复元组</p>
<p><strong>示例：查找2017年最多开设一次的所有课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> T.course_id</span><br><span class="line"><span class="keyword">from</span> course <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">unique</span> (</span><br><span class="line">    <span class="keyword">select</span> R.course_id</span><br><span class="line">    <span class="keyword">from</span> section <span class="keyword">as</span> R</span><br><span class="line">    <span class="keyword">where</span> T.course_id <span class="operator">=</span> R.course_id</span><br><span class="line">        <span class="keyword">and</span> R.year <span class="operator">=</span> <span class="number">2017</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="9-8-FROM子句中的子查询"><a href="#9-8-FROM子句中的子查询" class="headerlink" title="9.8 FROM子句中的子查询"></a>9.8 FROM子句中的子查询</h3><p><strong>示例：查找平均工资超过42000美元的系的平均教师工资</strong></p>
<p><strong>方法1：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name, avg_salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">as</span> avg_salary</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line">)</span><br><span class="line"><span class="keyword">where</span> avg_salary <span class="operator">&gt;</span> <span class="number">42000</span></span><br></pre></td></tr></table></figure>

<p><strong>方法2：给派生关系命名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name, avg_salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> dept_name, <span class="built_in">avg</span>(salary)</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line">) <span class="keyword">as</span> dept_avg(dept_name, avg_salary)</span><br><span class="line"><span class="keyword">where</span> avg_salary <span class="operator">&gt;</span> <span class="number">42000</span></span><br></pre></td></tr></table></figure>

<h3 id="9-9-WITH子句（推荐使用）"><a href="#9-9-WITH子句（推荐使用）" class="headerlink" title="9.9 WITH子句（推荐使用）"></a>9.9 WITH子句（推荐使用）</h3><p><strong>功能：</strong> WITH子句提供了一种定义临时关系的方法，该关系仅在包含WITH子句的查询中可用。</p>
<p><strong>优点：</strong> 将复杂查询分解为若干步，每个视图定义一个中间计算结果，逻辑清晰。</p>
<p><strong>示例1：查找所有预算最高的系</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> max_budget(<span class="keyword">value</span>) <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">max</span>(budget)</span><br><span class="line">    <span class="keyword">from</span> department</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> department.name</span><br><span class="line"><span class="keyword">from</span> department, max_budget</span><br><span class="line"><span class="keyword">where</span> department.budget <span class="operator">=</span> max_budget.value</span><br></pre></td></tr></table></figure>

<p><strong>示例2：查找总工资大于所有系平均总工资的系</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> dept_total(dept_name, <span class="keyword">value</span>) <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> dept_name, <span class="built_in">sum</span>(salary)</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line">),</span><br><span class="line">dept_total_avg(<span class="keyword">value</span>) <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="keyword">from</span> dept_total</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> dept_name</span><br><span class="line"><span class="keyword">from</span> dept_total, dept_total_avg</span><br><span class="line"><span class="keyword">where</span> dept_total.value <span class="operator">&gt;</span> dept_total_avg.value</span><br></pre></td></tr></table></figure>


<h3 id="9-10-标量子查询（Scalar-Subquery）"><a href="#9-10-标量子查询（Scalar-Subquery）" class="headerlink" title="9.10 标量子查询（Scalar Subquery）"></a>9.10 标量子查询（Scalar Subquery）</h3><p><strong>定义：</strong> 标量子查询是期望返回单个值的子查询</p>
<p><strong>示例：列出所有系及其教师数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name,</span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">     <span class="keyword">from</span> instructor</span><br><span class="line">     <span class="keyword">where</span> department.dept_name <span class="operator">=</span> instructor.dept_name)</span><br><span class="line">    <span class="keyword">as</span> num_instructors</span><br><span class="line"><span class="keyword">from</span> department</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十、数据库修改（Database-Modification）"><a href="#十、数据库修改（Database-Modification）" class="headerlink" title="十、数据库修改（Database Modification）"></a>十、数据库修改（Database Modification）</h2><h3 id="10-1-删除操作（DELETE）"><a href="#10-1-删除操作（DELETE）" class="headerlink" title="10.1 删除操作（DELETE）"></a>10.1 删除操作（DELETE）</h3><p><strong>基本语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> r</span><br><span class="line"><span class="keyword">where</span> P</span><br></pre></td></tr></table></figure>

<p><strong>示例1：删除所有教师</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> instructor</span><br></pre></td></tr></table></figure>

<p><strong>示例2：删除财务系的所有教师</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Finance&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>示例3：删除Watson楼中系的所有教师</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> dept_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> dept_name</span><br><span class="line">    <span class="keyword">from</span> department</span><br><span class="line">    <span class="keyword">where</span> building <span class="operator">=</span> <span class="string">&#x27;Watson&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>示例4：删除工资低于平均工资的教师</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&lt;</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>执行顺序问题：</strong></p>
<ul>
<li>删除元组时，平均工资会改变</li>
<li>解决方案：<ol>
<li>首先计算avg(salary)并找到所有要删除的元组</li>
<li>然后删除所有找到的元组（不重新计算平均值或重新测试元组）</li>
</ol>
</li>
</ul>
<h3 id="10-2-插入操作（INSERT）"><a href="#10-2-插入操作（INSERT）" class="headerlink" title="10.2 插入操作（INSERT）"></a>10.2 插入操作（INSERT）</h3><p><strong>基本语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> r</span><br><span class="line"><span class="keyword">values</span> (v1, v2, ..., vn)</span><br></pre></td></tr></table></figure>

<p><strong>示例1：添加新课程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> course</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;CS-437&#x27;</span>, <span class="string">&#x27;Database Systems&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价写法</span></span><br><span class="line"><span class="keyword">insert into</span> course (course_id, title, dept_name, credits)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;CS-437&#x27;</span>, <span class="string">&#x27;Database Systems&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p><strong>示例2：插入NULL值</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> student</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;3003&#x27;</span>, <span class="string">&#x27;Green&#x27;</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="keyword">null</span>)</span><br></pre></td></tr></table></figure>

<p><strong>示例3：从查询结果插入</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将音乐系中获得超过144学分的每个学生</span></span><br><span class="line"><span class="comment">-- 聘为音乐系教师，工资为18000美元</span></span><br><span class="line"><span class="keyword">insert into</span> instructor</span><br><span class="line"><span class="keyword">select</span> ID, name, dept_name, <span class="number">18000</span></span><br><span class="line"><span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Music&#x27;</span> <span class="keyword">and</span> total_cred <span class="operator">&gt;</span> <span class="number">144</span></span><br></pre></td></tr></table></figure>

<p><strong>重要特性：</strong> SELECT-FROM-WHERE语句在将其结果插入关系之前完全求值。否则像下面的查询会导致问题：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> table1 </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table1</span><br></pre></td></tr></table></figure>

<h3 id="10-3-更新操作（UPDATE）"><a href="#10-3-更新操作（UPDATE）" class="headerlink" title="10.3 更新操作（UPDATE）"></a>10.3 更新操作（UPDATE）</h3><p><strong>基本语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> r</span><br><span class="line"><span class="keyword">set</span> A <span class="operator">=</span> <span class="keyword">value</span></span><br><span class="line"><span class="keyword">where</span> P</span><br></pre></td></tr></table></figure>

<p><strong>示例1：给所有教师加薪5%</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br></pre></td></tr></table></figure>

<p><strong>示例2：条件更新</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 给工资低于70000的教师加薪5%</span></span><br><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&lt;</span> <span class="number">70000</span></span><br></pre></td></tr></table></figure>

<p><strong>示例3：使用子查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 给工资低于平均工资的教师加薪5%</span></span><br><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&lt;</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>示例4：多条件更新的顺序问题</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 工资超过100000的教师加薪3%，其他加薪5%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方案1：两个UPDATE语句（顺序很重要！）</span></span><br><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line"><span class="keyword">where</span> salary <span class="operator">&lt;=</span> <span class="number">100000</span>;</span><br><span class="line"><span class="comment">-- 如果顺序相反，初始工资为99999的教师会被加薪两次</span></span><br></pre></td></tr></table></figure>

<h3 id="10-4-条件更新-CASE语句"><a href="#10-4-条件更新-CASE语句" class="headerlink" title="10.4 条件更新 - CASE语句"></a>10.4 条件更新 - CASE语句</h3><p><strong>更好的解决方案：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> instructor</span><br><span class="line"><span class="keyword">set</span> salary <span class="operator">=</span> <span class="keyword">case</span></span><br><span class="line">    <span class="keyword">when</span> salary <span class="operator">&lt;=</span> <span class="number">100000</span> <span class="keyword">then</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line">    <span class="keyword">else</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="10-5-使用标量子查询更新"><a href="#10-5-使用标量子查询更新" class="headerlink" title="10.5 使用标量子查询更新"></a>10.5 使用标量子查询更新</h3><p><strong>示例：重新计算并更新所有学生的tot_creds值</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> student S</span><br><span class="line"><span class="keyword">set</span> tot_cred <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">sum</span>(credits)</span><br><span class="line">    <span class="keyword">from</span> takes, course</span><br><span class="line">    <span class="keyword">where</span> takes.course_id <span class="operator">=</span> course.course_id</span><br><span class="line">        <span class="keyword">and</span> S.ID <span class="operator">=</span> takes.ID</span><br><span class="line">        <span class="keyword">and</span> takes.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">        <span class="keyword">and</span> takes.grade <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>问题：</strong> 对于没有选修任何课程的学生，tot_creds会被设置为NULL</p>
<p><strong>改进方案：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> student S</span><br><span class="line"><span class="keyword">set</span> tot_cred <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> <span class="built_in">sum</span>(credits) <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">then</span> <span class="built_in">sum</span>(credits)</span><br><span class="line">        <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">from</span> takes, course</span><br><span class="line">    <span class="keyword">where</span> takes.course_id <span class="operator">=</span> course.course_id</span><br><span class="line">        <span class="keyword">and</span> S.ID <span class="operator">=</span> takes.ID</span><br><span class="line">        <span class="keyword">and</span> takes.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">        <span class="keyword">and</span> takes.grade <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="10-6-多表更新"><a href="#10-6-多表更新" class="headerlink" title="10.6 多表更新"></a>10.6 多表更新</h3><p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 给定：</span></span><br><span class="line"><span class="comment">-- Student(S#, Sname, age, ..., C#, Grade, ...)</span></span><br><span class="line"><span class="comment">-- SGrade(S#, C#, Grade)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 利用SGrade的内容更新Student</span></span><br><span class="line"><span class="keyword">update</span> Student <span class="keyword">as</span> A</span><br><span class="line"><span class="keyword">set</span> Grade <span class="operator">=</span> B.Grade</span><br><span class="line"><span class="keyword">from</span> SGrade <span class="keyword">as</span> B</span><br><span class="line"><span class="keyword">where</span> A.S# <span class="operator">=</span> B.S# <span class="keyword">and</span> A.C# <span class="operator">=</span> B.C#</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十一、重要实践建议"><a href="#十一、重要实践建议" class="headerlink" title="十一、重要实践建议"></a>十一、重要实践建议</h2><h3 id="11-1-命名规范"><a href="#11-1-命名规范" class="headerlink" title="11.1 命名规范"></a>11.1 命名规范</h3><ul>
<li>在Oracle等大型商用数据库系统中，关系表的属性名只能取英文名，不支持中文属性名</li>
<li>SQL Server支持中英文属性名</li>
<li>开发大型数据库应用时，程序访问的关系表属性名（最好）取英文名，便于应用程序的可移植性</li>
<li>准确表示英文专业术语</li>
</ul>
<h3 id="11-2-性能优化建议"><a href="#11-2-性能优化建议" class="headerlink" title="11.2 性能优化建议"></a>11.2 性能优化建议</h3><p>**1. 避免使用SELECT ***</p>
<ul>
<li>实际应用中避免在SELECT子句中使用*</li>
<li>防止索引失效</li>
</ul>
<p><strong>2. 避免属性NULL值</strong></p>
<ul>
<li>实际应用中避免引入属性NULL值</li>
<li>防止索引失效</li>
<li>用默认值（default value）替代</li>
</ul>
<p><strong>3. 控制FROM子句的表数量</strong></p>
<ul>
<li>FROM子句包括多个关系表时，要在WHERE子句中加入连接条件</li>
<li>防止出现代价高昂的多表笛卡尔积操作</li>
<li>频繁执行的SQL查询，FROM子句的表个数不要过多（不超过4个表）</li>
<li>如需查询涉及≥4张表，考虑将数据进行合并</li>
</ul>
<p><strong>4. 避免低效的嵌套查询</strong></p>
<ul>
<li>从SQL优化角度，避免使用低效的嵌套查询</li>
<li>改为FROM子句中的多表连接，便于DBMS查询优化</li>
</ul>
<p><strong>5. 避免大数据排序</strong></p>
<ul>
<li>不要用数据库的ORDER BY操作对大数据文件进行排序</li>
</ul>
<p><strong>6. 优先使用WITH子句</strong></p>
<ul>
<li>使用WITH子句将复杂查询分解为多步</li>
<li>逻辑清晰，便于维护</li>
</ul>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这份课件涵盖了SQL的核心知识点：</p>
<ol>
<li><strong>数据定义（DDL）</strong> - 创建、修改、删除表结构</li>
<li><strong>基本查询（DML）</strong> - SELECT-FROM-WHERE结构</li>
<li><strong>高级查询</strong> - 连接、聚合、分组、排序</li>
<li><strong>集合操作</strong> - UNION、INTERSECT、EXCEPT</li>
<li><strong>嵌套查询</strong> - IN、EXISTS、ALL、SOME等</li>
<li><strong>数据修改</strong> - INSERT、DELETE、UPDATE</li>
</ol>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/my_avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/my_avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Yuejin Wu</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/')">Intro-to-SQL 简读</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Intro-to-SQL 简读&amp;url=http://example.com/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/&amp;pic=/img/db_cover.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Yuejin's Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>数据库<span class="categoryesPageCount">2</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Database/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Database<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/SQL/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>SQL<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="social-share" data-image="/img/db_cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/12/22/DB_%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E7%AE%80%E8%AF%BB/"><img class="prev-cover" src="/img/db_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">关系模型 简读</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/12/22/DB_%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E7%AE%80%E8%AF%BB/" title="关系模型 简读"><img class="cover" src="/img/db_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-22</div><div class="title">关系模型 简读</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src="/img/my_avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div class="author-intro" style="line-height: 1.7; text-align: center; font-family: inherit; margin-top: -0.5rem; margin-bottom: 0.5rem;">
  <p style="font-size: 1.15rem; margin-bottom: 0.8rem; font-weight: 500; color: var(--anzhiyu-fontcolor);">你好，我是 <span style="color: #00ffcc; font-weight: 600; text-shadow: 0 0 5px #00ffccaa;">Yuejin Wu</span>！👋</p>
  <p style="font-size: 1.05rem; margin-bottom: 0.6rem; opacity: 0.9; color: var(--anzhiyu-fontcolor);">BUPT 本科生 · 人工智能专业</p>
  <p style="font-size: 1.05rem; margin-bottom: 1rem; opacity: 0.9; color: var(--anzhiyu-fontcolor);">记录学习、思考与生活</p>
  <p style="font-size: 1.1rem; margin-top: 1rem; padding-top: 0.8rem; border-top: 1px solid var(--anzhiyu-theme-op); font-weight: 600; color: #FF0066; text-shadow: 0 0 5px #FF0066, 0 0 5px #FF0066aa;">
   保持好奇，持续探索
  </p>
</div>
</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Yuejin Wu</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/YuejinWu/YuejinWu.github.io" target="_blank" title="Github"></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81SQL%E6%A6%82%E8%BF%B0%EF%BC%88Overview-of-SQL%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">一、SQL概述（Overview of SQL）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-SQL%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 SQL的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-SQL%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 SQL的组成部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81SQL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%EF%BC%88DDL%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">二、SQL数据定义（DDL）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-DDL%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 DDL的功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%9F%9F%E7%B1%BB%E5%9E%8B%EF%BC%88Domain-Types%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 域类型（Domain Types）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%88Create-Table%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 创建表（Create Table）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F%EF%BC%88Integrity-Constraints%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 完整性约束（Integrity Constraints）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E6%A8%A1%E5%BC%8F%E6%9B%B4%E6%96%B0%EF%BC%88Schema-Updates%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 模式更新（Schema Updates）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81SQL%E6%9F%A5%E8%AF%A2%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">三、SQL查询基本结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E5%BD%A2%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 基本查询形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-SELECT%E5%AD%90%E5%8F%A5%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 SELECT子句详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-WHERE%E5%AD%90%E5%8F%A5%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 WHERE子句详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-FROM%E5%AD%90%E5%8F%A5%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 FROM子句详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5%EF%BC%88Natural-Join%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 自然连接（Natural Join）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81SQL%E6%9F%A5%E8%AF%A2%E7%9A%84%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">四、SQL查询的计算过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%8C%E6%95%B4%E7%9A%84SELECT%E8%AF%AD%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 完整的SELECT语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 查询执行顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%85%B6%E4%BB%96%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">五、其他基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E9%87%8D%E5%91%BD%E5%90%8D%E6%93%8D%E4%BD%9C%EF%BC%88RENAME%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 重命名操作（RENAME）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 字符串操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E7%BB%93%E6%9E%9C%E6%8E%92%E5%BA%8F%EF%BC%88ORDER-BY%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 结果排序（ORDER BY）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C%EF%BC%88Set-Operations%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">六、集合操作（Set Operations）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%9F%BA%E6%9C%AC%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 基本集合操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-UNION%EF%BC%88%E5%B9%B6%E9%9B%86%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 UNION（并集）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-INTERSECT%EF%BC%88%E4%BA%A4%E9%9B%86%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 INTERSECT（交集）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-EXCEPT%EF%BC%88%E5%B7%AE%E9%9B%86%EF%BC%89"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 EXCEPT（差集）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%A9%BA%E5%80%BC%E5%A4%84%E7%90%86%EF%BC%88NULL-Values%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">七、空值处理（NULL Values）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-NULL%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 NULL的含义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E4%B8%8ENULL"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 算术运算与NULL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E6%A3%80%E6%9F%A5NULL%E5%80%BC"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 检查NULL值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E4%B8%8ENULL"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 比较运算与NULL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%B8%83%E5%B0%94%E8%BF%90%E7%AE%97%E4%B8%8EUNKNOWN"><span class="toc-number">7.5.</span> <span class="toc-text">7.5 布尔运算与UNKNOWN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%EF%BC%88Aggregate-Functions%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">八、聚合函数（Aggregate Functions）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%9F%BA%E6%9C%AC%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 基本聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E8%AF%AD%E6%B3%95"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 聚合函数语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E5%9F%BA%E6%9C%AC%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 基本聚合示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-GROUP-BY%E5%AD%90%E5%8F%A5"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 GROUP BY子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-HAVING%E5%AD%90%E5%8F%A5"><span class="toc-number">8.5.</span> <span class="toc-text">8.5 HAVING子句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88Nested-Subqueries%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">九、嵌套子查询（Nested Subqueries）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E9%9B%86%E5%90%88%E6%88%90%E5%91%98%E8%B5%84%E6%A0%BC%EF%BC%88Set-Membership%EF%BC%89"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 集合成员资格（Set Membership）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E9%9B%86%E5%90%88%E6%AF%94%E8%BE%83-SOME%E5%AD%90%E5%8F%A5"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 集合比较 - SOME子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E9%9B%86%E5%90%88%E6%AF%94%E8%BE%83-ALL%E5%AD%90%E5%8F%A5"><span class="toc-number">9.4.</span> <span class="toc-text">9.4 集合比较 - ALL子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-%E6%B5%8B%E8%AF%95%E7%A9%BA%E5%85%B3%E7%B3%BB-EXISTS"><span class="toc-number">9.5.</span> <span class="toc-text">9.5 测试空关系 - EXISTS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-NOT-EXISTS%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.6.</span> <span class="toc-text">9.6 NOT EXISTS的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-%E6%B5%8B%E8%AF%95%E9%87%8D%E5%A4%8D%E5%85%83%E7%BB%84-UNIQUE"><span class="toc-number">9.7.</span> <span class="toc-text">9.7 测试重复元组 - UNIQUE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-FROM%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.8.</span> <span class="toc-text">9.8 FROM子句中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-9-WITH%E5%AD%90%E5%8F%A5%EF%BC%88%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="toc-number">9.9.</span> <span class="toc-text">9.9 WITH子句（推荐使用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-10-%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88Scalar-Subquery%EF%BC%89"><span class="toc-number">9.10.</span> <span class="toc-text">9.10 标量子查询（Scalar Subquery）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E6%94%B9%EF%BC%88Database-Modification%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">十、数据库修改（Database Modification）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%EF%BC%88DELETE%EF%BC%89"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 删除操作（DELETE）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C%EF%BC%88INSERT%EF%BC%89"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 插入操作（INSERT）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C%EF%BC%88UPDATE%EF%BC%89"><span class="toc-number">10.3.</span> <span class="toc-text">10.3 更新操作（UPDATE）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-%E6%9D%A1%E4%BB%B6%E6%9B%B4%E6%96%B0-CASE%E8%AF%AD%E5%8F%A5"><span class="toc-number">10.4.</span> <span class="toc-text">10.4 条件更新 - CASE语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-%E4%BD%BF%E7%94%A8%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%9B%B4%E6%96%B0"><span class="toc-number">10.5.</span> <span class="toc-text">10.5 使用标量子查询更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-%E5%A4%9A%E8%A1%A8%E6%9B%B4%E6%96%B0"><span class="toc-number">10.6.</span> <span class="toc-text">10.6 多表更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E9%87%8D%E8%A6%81%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-number">11.</span> <span class="toc-text">十一、重要实践建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-number">11.1.</span> <span class="toc-text">11.1 命名规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">11.2.</span> <span class="toc-text">11.2 性能优化建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">12.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/" title="Intro-to-SQL 简读"><img src="/img/db_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Intro-to-SQL 简读"/></a><div class="content"><a class="title" href="/2025/12/22/DB_SQL%20%E8%AF%AD%E8%A8%80%E7%AE%80%E8%AF%BB/" title="Intro-to-SQL 简读">Intro-to-SQL 简读</a><time datetime="2025-12-22T06:53:42.900Z" title="发表于 2025-12-22 14:53:42">2025-12-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/22/DB_%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E7%AE%80%E8%AF%BB/" title="关系模型 简读"><img src="/img/db_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关系模型 简读"/></a><div class="content"><a class="title" href="/2025/12/22/DB_%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E7%AE%80%E8%AF%BB/" title="关系模型 简读">关系模型 简读</a><time datetime="2025-12-22T06:49:25.619Z" title="发表于 2025-12-22 14:49:25">2025-12-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/16/self-attention%E7%AE%80%E8%AF%BB/" title="自注意力机制_简读"><img src="/img/selfatten_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自注意力机制_简读"/></a><div class="content"><a class="title" href="/2025/12/16/self-attention%E7%AE%80%E8%AF%BB/" title="自注意力机制_简读">自注意力机制_简读</a><time datetime="2025-12-16T15:51:52.277Z" title="发表于 2025-12-16 23:51:52">2025-12-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/16/RNN%E7%AC%94%E8%AE%B0/" title="LSTM简读"><img src="/img/LSTM_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LSTM简读"/></a><div class="content"><a class="title" href="/2025/12/16/RNN%E7%AC%94%E8%AE%B0/" title="LSTM简读">LSTM简读</a><time datetime="2025-12-15T22:48:10.375Z" title="发表于 2025-12-16 06:48:10">2025-12-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/10/%E9%97%B2%E8%A8%80%E7%A2%8E%E8%AF%AD2/" title="生活感悟"><img src="/img/aniya.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="生活感悟"/></a><div class="content"><a class="title" href="/2025/12/10/%E9%97%B2%E8%A8%80%E7%A2%8E%E8%AF%AD2/" title="生活感悟">生活感悟</a><time datetime="2025-12-09T17:15:58.128Z" title="发表于 2025-12-10 01:15:58">2025-12-10</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="Yuejin Wu" target="_blank">Yuejin Wu</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" href="/" title="首页">首页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://hexo.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI-Platform/" style="font-size: 0.88rem;">AI Platform<sup>1</sup></a><a href="/tags/Database/" style="font-size: 0.88rem;">Database<sup>2</sup></a><a href="/tags/English/" style="font-size: 0.88rem;">English<sup>1</sup></a><a href="/tags/RNN/" style="font-size: 0.88rem;">RNN<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>1</sup></a><a href="/tags/Self-Attention/" style="font-size: 0.88rem;">Self Attention<sup>1</sup></a><a href="/tags/plan/" style="font-size: 0.88rem;">plan<sup>2</sup></a><a href="/tags/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/" style="font-size: 0.88rem;">关系模型<sup>1</sup></a><a href="/tags/%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B/" style="font-size: 0.88rem;">自注意力<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.7.0",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Yuejin Wu 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>